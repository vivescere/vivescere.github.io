<!doctype html><html lang=en><head><title>Writeup Cyber Threat Force : Return to the school :: Nicolas Bourras</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This challenge involved solving an ASCII maze in under 10 seconds. I can&amp;rsquo;t include a demo because I&amp;rsquo;m writing this after the CTF ended.
My script uses the astar package, because I was too lazy to re-implement A* manually. It isn&amp;rsquo;t particularly pretty, but at least it is functionnal.
Here it is:
import math from pwn import * from astar import AStar def parse_maze(source): source = source.strip() source = source.split(&amp;#39;\n&amp;#39;) source = source[:-1] # Remove last line (dots) source = [list(l[1:-1]) for l in source] # Remove left and right dots return source # Mostly copied from the astar package example."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-misc-return-to-the-school/><link rel=stylesheet href=https://nicolasb.fr/assets/style.css><link rel=stylesheet href=https://nicolasb.fr/assets/pink.css><link rel=apple-touch-icon href=https://nicolasb.fr/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://nicolasb.fr/img/favicon/pink.png><meta name=twitter:card content="summary"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Writeup Cyber Threat Force : Return to the school"><meta property="og:description" content="This challenge involved solving an ASCII maze in under 10 seconds. I can&amp;rsquo;t include a demo because I&amp;rsquo;m writing this after the CTF ended.
My script uses the astar package, because I was too lazy to re-implement A* manually. It isn&amp;rsquo;t particularly pretty, but at least it is functionnal.
Here it is:
import math from pwn import * from astar import AStar def parse_maze(source): source = source.strip() source = source.split(&amp;#39;\n&amp;#39;) source = source[:-1] # Remove last line (dots) source = [list(l[1:-1]) for l in source] # Remove left and right dots return source # Mostly copied from the astar package example."><meta property="og:url" content="https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-misc-return-to-the-school/"><meta property="og:site_name" content="Nicolas Bourras"><meta property="og:image" content="https://nicolasb.fr/img/favicon/pink.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-07-08 22:12:09 +0100 +0100"></head><body class=pink><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Nicolas Bourras</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/>About</a></li><li><a href=/blog>Blog</a></li><li><a href=/recipes>Recipes</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>About</a></li><li><a href=/blog>Blog</a></li><li><a href=/recipes>Recipes</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-misc-return-to-the-school/>Writeup Cyber Threat Force : Return to the school</a></h1><div class=post-meta><span class=post-date>2021-07-08</span></div><span class=post-tags>#<a href=https://nicolasb.fr/tags/blog/>blog</a>&nbsp;
#<a href=https://nicolasb.fr/tags/security/>security</a>&nbsp;
#<a href=https://nicolasb.fr/tags/ctf/>ctf</a>&nbsp;
#<a href=https://nicolasb.fr/tags/cyber-threat-force/>cyber-threat-force</a>&nbsp;
#<a href=https://nicolasb.fr/tags/misc/>misc</a>&nbsp;</span><div class=post-content><div><p>This challenge involved solving an ASCII maze in under 10 seconds. I can&rsquo;t include a demo because I&rsquo;m writing this after the CTF ended.</p><p>My script uses the <a href=https://github.com/jrialland/python-astar>astar</a> package, because I was too lazy to re-implement A* manually. It isn&rsquo;t particularly pretty, but at least it is functionnal.</p><p>Here it is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> astar <span style=color:#f92672>import</span> AStar
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_maze</span>(source):
</span></span><span style=display:flex><span>        source <span style=color:#f92672>=</span> source<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        source <span style=color:#f92672>=</span> source<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        source <span style=color:#f92672>=</span> source[:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]  <span style=color:#75715e># Remove last line (dots)</span>
</span></span><span style=display:flex><span>        source <span style=color:#f92672>=</span> [list(l[<span style=color:#ae81ff>1</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]) <span style=color:#66d9ef>for</span> l <span style=color:#f92672>in</span> source]  <span style=color:#75715e># Remove left and right dots</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> source
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Mostly copied from the astar package example.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MazeSolver</span>(AStar):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> __init__(self, maze):
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>maze <span style=color:#f92672>=</span> maze
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>height <span style=color:#f92672>=</span> len(maze)
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>width <span style=color:#f92672>=</span> len(maze[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>heuristic_cost_estimate</span>(self, n1, n2):
</span></span><span style=display:flex><span>                (x1, y1) <span style=color:#f92672>=</span> n1
</span></span><span style=display:flex><span>                (x2, y2) <span style=color:#f92672>=</span> n2
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> math<span style=color:#f92672>.</span>hypot(x2 <span style=color:#f92672>-</span> x1, y2 <span style=color:#f92672>-</span> y1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>distance_between</span>(self, n1, n2):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>neighbors</span>(self, node):
</span></span><span style=display:flex><span>                x, y <span style=color:#f92672>=</span> node
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>                        (nx, ny)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>for</span> nx, ny
</span></span><span style=display:flex><span>                        <span style=color:#f92672>in</span> [
</span></span><span style=display:flex><span>                                (x, y <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>                                (x, y <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>                                (x <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, y),
</span></span><span style=display:flex><span>                                (x <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, y)
</span></span><span style=display:flex><span>                        ]
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&lt;=</span> nx <span style=color:#f92672>&lt;</span> self<span style=color:#f92672>.</span>width <span style=color:#f92672>and</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&lt;=</span> ny <span style=color:#f92672>&lt;</span> self<span style=color:#f92672>.</span>height <span style=color:#f92672>and</span> self<span style=color:#f92672>.</span>maze[ny][nx] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39; &#39;</span>
</span></span><span style=display:flex><span>                ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>sol_to_dir</span>(i):
</span></span><span style=display:flex><span>        last <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        steps <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> element <span style=color:#f92672>in</span> i:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> last <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                        last <span style=color:#f92672>=</span> element
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                old_x, old_y <span style=color:#f92672>=</span> last
</span></span><span style=display:flex><span>                x, y <span style=color:#f92672>=</span> element
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> old_x <span style=color:#f92672>&lt;</span> x:
</span></span><span style=display:flex><span>                        steps<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;O&#39;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> old_x <span style=color:#f92672>&gt;</span> x:
</span></span><span style=display:flex><span>                        steps<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;E&#39;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> old_y <span style=color:#f92672>&lt;</span> y:
</span></span><span style=display:flex><span>                        steps<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;S&#39;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> old_y <span style=color:#f92672>&gt;</span> y:
</span></span><span style=display:flex><span>                        steps<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;N&#39;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>RuntimeError</span>(<span style=color:#e6db74>&#39;should not happen&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                last <span style=color:#f92672>=</span> element
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> steps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;XXX.XXX.XXX.XXX&#39;</span>, <span style=color:#ae81ff>00000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>header <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>92</span>)<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>maze <span style=color:#f92672>=</span> parse_maze(r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>92</span>)<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>width <span style=color:#f92672>=</span> len(maze[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>height <span style=color:#f92672>=</span> len(maze)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># We want the path from the bottom right corner, to the top left one.</span>
</span></span><span style=display:flex><span>start <span style=color:#f92672>=</span> (width <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, height <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>goal <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>solution <span style=color:#f92672>=</span> list(MazeSolver(maze)<span style=color:#f92672>.</span>astar(start, goal))
</span></span><span style=display:flex><span>solution <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(sol_to_dir(solution))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>send(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>solution<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;---------------&#39;</span>)
</span></span><span style=display:flex><span>print(r<span style=color:#f92672>.</span>recvall()<span style=color:#f92672>.</span>decode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><p>The flag was <code>CYBERTF{M@ze_Mast3r}</code>.</p><p>You can <a href=https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/misc/return-to-the-school>view the sources on github</a> or <a href=/blog/cyber-threat-force-ctf/>read other writeups</a>.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-take-your-time/><span class=button__icon>←</span>
<span class=button__text>Writeup Cyber Threat Force : Take your time</span></a></span>
<span class="button next"><a href=https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-pwn-privesc/><span class=button__text>Writeup Cyber Threat Force : PrivEsc</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://nicolasb.fr/assets/main.js></script>
<script src=https://nicolasb.fr/assets/prism.js></script></div></body></html>